<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Laughing All the Way</title>

  <!-- PWA basics -->
  <meta name="theme-color" content="#d93823" />
  <link rel="manifest" href="manifest.webmanifest" />

  <!-- Icons in repo root -->
  <link rel="icon" href="icon-192.png" sizes="192x192" />
  <link rel="apple-touch-icon" href="icon-192.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="Laughing All the Way" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#d93823;
      --ink:#1f2a35;
      --card:#ffffff;
      --shadow:rgba(0,0,0,0.15);
      --line:#e5ecf0;
      --teal:#237e6b;
    }

    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      display:flex; flex-direction:column; min-height:100vh;
    }

    /* App wrapper + blur when gated */
    #appWrap{flex:1}
    #appWrap.blur{filter:blur(4px) saturate(.9); pointer-events:none; user-select:none}

    /* Header */
    header{text-align:center; padding:14px 16px 4px;}
    .brand{
      width:320px; max-width:78vw; height:auto;
      display:inline-block; border-radius:18px;
      box-shadow:0 6px 18px var(--shadow);
      background:transparent; position:relative; z-index:3;
    }

    .controls{display:flex; gap:10px; justify-content:center; margin:8px 0}
    .pill{
      background:var(--card); border:1px solid var(--line);
      padding:8px 12px; border-radius:999px;
      box-shadow:0 2px 6px var(--shadow);
      font-size:.9rem; cursor:pointer;
    }
    #installBtn{display:none}

    /* Install-help bar */
    .install-help {position:sticky; top:0; z-index:10001; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .install-help__wrap{background:#fff7f4; border-bottom:1px solid #f2e7e3}
    .install-help__summary{display:flex; align-items:center; gap:.5rem; padding:.55rem .85rem; cursor:pointer; font-size:.95rem}
    .install-help__summary:hover{background:#fff3ee}
    summary.install-help__wrap::-webkit-details-marker{display:none}
    summary.install-help__wrap::marker{content:''; font-size:0}
    .install-help__summary .caret{transition:transform .2s ease; width:40px; height:40px}
    details[open] .install-help__summary .caret{transform:rotate(180deg)}
    details[open] .install-help__wrap{box-shadow:inset 0 -1px 0 #e7d8d3, 0 1px 0 #e7d8d3}
    .install-help__panel{padding:.75rem .9rem .95rem .9rem; display:grid; gap:.75rem; background:#fff}
    .install-help__panel h4{margin:.25rem 0 .25rem 0; font-size:.95rem}
    .install-help__panel p{margin:0 0 .35rem 0; font-size:.9rem}
    .install-help__close{all:unset; display:inline-grid; place-items:center; width:32px; height:32px; cursor:pointer; color:#000; line-height:1; font-weight:700}
    .install-help__tips{font-size:.85rem; opacity:.9}
    .install-help__box{border:1px solid #efdfda; background:#fff; border-radius:.65rem; padding:.65rem .75rem}
    .install-help__steps{margin:.25rem 0 0 1.15rem}
    .install-help__steps li{margin:.25rem 0}
    .install-help__never{align-self:start; border:0; background:transparent; padding:0; font:inherit; color:#6b7f88; text-decoration:underline; cursor:pointer}
    .hidden{display:none}
    .install-help.gate-hide{display:none}
    @media (prefers-reduced-motion: reduce){.install-help__summary .caret{transition:none}}

    /* Grid */
    .grid{
      display:grid; grid-template-columns:repeat(5,1fr);
      gap:12px; padding:16px; max-width:820px; margin:10px auto 20px;
      position:relative; z-index:2;
    }
    .tile{
      aspect-ratio:1/1; background:#fff8d2; color:var(--teal);
      border-radius:22px; border:4px solid var(--teal);
      display:flex; align-items:center; justify-content:center;
      font-family:'Baloo 2',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      font-weight:700; font-size:2.3rem;
      box-shadow:0 3px 10px var(--shadow);
      cursor:pointer; position:relative; user-select:none;
      transition:transform .1s ease, box-shadow .1s ease; overflow:hidden;
    }
    .tile:hover{transform:translateY(-2px); box-shadow:0 5px 14px var(--shadow)}
    .tile.opened{outline:3px solid rgba(35,126,107,.35)}
    .tile::before{
      content:""; position:absolute; top:0; left:0; right:0; height:20%;
      border-bottom:4px solid var(--teal);
      border-top-left-radius:18px; border-top-right-radius:18px;
    }

    /* Viewer */
    .viewer{position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; align-items:center; justify-content:center; padding:16px; z-index:3}
    .viewer.open{display:flex}
    .card{
      width:min(760px,92vw); max-height:86vh; overflow:auto;
      background:var(--card); border-radius:26px;
      box-shadow:0 8px 30px rgba(0,0,0,.25);
      border:2px solid rgba(35,126,107,.15);
      padding:22px 22px 26px;
      transform:translateY(8px); animation:pop .18s ease-out both;
    }
    @keyframes pop{from{opacity:0; transform:translateY(12px)} to{opacity:1; transform:translateY(0)}}
    .card h2{margin:0 0 8px; font-size:1.35rem; letter-spacing:.3px; color:var(--teal); font-family:'Baloo 2',system-ui; font-weight:700}
    .prompt{
      font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif !important;
      font-size:1.05rem; line-height:1.5; color:var(--ink);
      white-space:pre-line;
    }
    .prompt em{color:var(--teal); font-style:normal; font-weight:600}
    .close{position:sticky; top:-8px; float:right; background:#f1f5f9; border:0; border-radius:10px; padding:8px 10px; cursor:pointer; font-weight:700; color:#2b4a5e; box-shadow:0 2px 6px var(--shadow)}

    /* Snow behind everything */
    #snow{position:fixed; inset:0; pointer-events:none; z-index:0}
    header,main,footer,#appWrap{position:relative; z-index:2}

    footer{
      background:rgba(255,255,255,.92);
      border-top:1px solid var(--line);
      padding:12px 14px 18px; text-align:center;
      font-size:.78rem; line-height:1.25rem;
    }

    @media (max-width:620px){.grid{grid-template-columns:repeat(4,1fr)}}

    /* Generator + Mad Libs shared UI bits */
    .madlib-actions{display:flex;gap:.6rem;margin-top:.6rem;flex-wrap:wrap}
    .madlib-btn{all:unset;cursor:pointer;background:var(--teal);color:#fff;padding:.55rem .8rem;border-radius:.6rem;font-weight:700;box-shadow:0 2px 6px var(--shadow)}
    .madlib-btn.secondary{background:#eef3f5;color:#2b4a5e}
    .madlib-output{white-space:pre-line;font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;line-height:1.55;margin-top:.75rem;font-size:1.05rem}

    /* Mad Libs form */
    .madlib-form{display:grid;gap:.75rem;margin-top:.5rem}
    .madlib-grid{display:grid;grid-template-columns:1fr 1fr;gap:.6rem .8rem}
    @media (max-width:560px){.madlib-grid{grid-template-columns:1fr}}
    .madlib-field{display:grid;gap:.25rem}
    .madlib-field label{font-size:.9rem;color:var(--teal);font-weight:600}
    .madlib-field input{font:inherit;padding:.55rem .65rem;border:1px solid var(--line);border-radius:.55rem;background:#fff}

    /* Instruction bar */
    .instructions{
      background: var(--bg);
      color: #fff;
      font-family: "Poppins", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      font-weight: 700;
      font-size: 1rem;
      line-height: 1.4;
      padding: 0.55rem 0.75rem;
      border-radius: 10px;
      margin: 0 0 0.8rem;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }

    /* Welcome Card */
    .welcome-card {
      background: #fff8d2;
      color: #237e6b;
      font-family: "Poppins", system-ui, sans-serif;
      border-radius: 26px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.15);
      max-width: 760px;
      margin: 24px auto;
      padding: 28px 22px;
      text-align: left;
      line-height: 1.55;
    }
    .welcome-card h1 {
      font-family: 'Baloo 2', system-ui, sans-serif;
      font-size: 1.7rem;
      color: var(--teal);
      margin-bottom: .75rem;
    }
    .welcome-card h2 {
      font-family: 'Baloo 2', system-ui, sans-serif;
      font-size: 1.25rem;
      color: var(--teal);
      margin-top: 1.4rem;
    }
    .welcome-card ul { padding-left: 1.1rem; margin-top: .5rem; }
    .welcome-card li { margin-bottom: .4rem; }
    .start-btn {
      all: unset; display: inline-block; margin-top: 1.3rem;
      background: var(--teal); color: #fff; padding: .7rem 1.3rem;
      border-radius: .8rem; font-weight: 700; cursor: pointer;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2); text-align: center;
    }
    .start-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.25); }
    .download-note { text-align:center; font-family:"Poppins",system-ui,sans-serif; font-size:.95rem; color:#237e6b; margin-top:1rem; line-height:1.4; }
    .download-link { display:inline-block; margin-top:.3rem; color:var(--teal); font-weight:700; text-decoration:underline; cursor:pointer; }
    .download-link:hover { text-decoration:none; color:#1c6359; }
    .cta-link { display:inline-block; color:var(--teal); font-weight:700; text-decoration:underline; }
    .cta-link:hover { text-decoration:none; color:#1c6359; }

    /* ===== LATW Bonus Module ===== */
    [data-latw-bonus].latw-sticky {
      position: sticky; top: 0; z-index: 1000;
      background: #fff4db; border-bottom: 1px solid rgba(0,0,0,.06);
    }
    .latw-sticky__inner {
      max-width: 1000px; margin: 0 auto; padding: .6rem .9rem;
      display: flex; gap: .6rem; align-items: center; justify-content: space-between;
    }
    .latw-sticky__text { font-size: .95rem; line-height: 1.3; }
    .latw-emoji { font-size: 1.1rem; }
    .latw-btn {
      background:#d93823; color:#fff; border:0; border-radius:.5rem;
      padding:.5rem .75rem; font-weight:700; cursor:pointer;
    }

    /* Small corner star that never blocks the tile */
    .latw-star{
      position:absolute;
      right:.35rem;
      top:.35rem;
      background:transparent;
      border:0;
      font-size:1.1rem;
      line-height:1;
      padding:0;
      cursor:pointer;
      filter: drop-shadow(0 1px 0 rgba(0,0,0,.2));
      z-index:1;
    }
    .latw-star:focus-visible{ outline:2px solid #699eb0; border-radius:.25rem; }

    [data-latw-bonus].latw-modal {
      position: fixed; inset: 0; display: none; align-items: center; justify-content: center;
      background: rgba(0,0,0,.35); padding: 1rem; z-index: 10000;
    }
    .latw-modal.open { display: flex; }
    .latw-modal__content {
      width: min(720px, 96vw); max-height: 85vh; overflow: auto;
      background: #fffcf5; border-radius: 12px; border: 2px solid #699eb0; padding: 1rem 1rem 1.25rem;
    }
    .latw-modal__close { float: right; background: transparent; border: 0; font-size: 1.5rem; cursor: pointer; }
    .latw-vault-title { margin: .25rem 0 .75rem; font-family: 'Baloo 2', system-ui, sans-serif; color: #237e6b; }
    .latw-vault-list {
      list-style: none; padding: 0; margin: .5rem 0 1rem;
      display: grid; gap: .5rem; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }
    .latw-vault-item {
      width: 100%; text-align: left; padding: .6rem .7rem; border: 1px solid #699eb0;
      border-radius: .5rem; background: #fff; cursor: pointer; font-weight: 700;
      font-family: "Poppins", system-ui, sans-serif;
    }
    .latw-vault-item:focus-visible { outline: 2px solid #699eb0; }
    .latw-bonus-detail h3 { margin: .5rem 0 .25rem; font-family: 'Baloo 2', system-ui, sans-serif; color: #237e6b; }
    .latw-bonus-detail p { margin: 0; font-family: "Poppins", system-ui, sans-serif; }

    /* Viewed state */
    .tile.viewed { filter: saturate(.85) brightness(.98); }

    /* Small corner check that toggles viewed state */
    .tile-check {
      position:absolute;
      right:6px;
      bottom:6px;
      width:26px; height:26px;
      display:grid; place-items:center;
      font-size:0.95rem; font-weight:700; line-height:1;
      color:var(--teal);
      background:#fff; border:1px solid var(--teal);
      border-radius:6px; cursor:pointer;
      box-shadow:0 1px 3px var(--shadow);
      padding:0;
      z-index:2;
    }
    .tile-check:hover { background:#f6fffb; }
    .tile-check:focus-visible { outline:2px solid #699eb0; }
  </style>
</head>
<body>
  <!-- Snow -->
  <canvas id="snow"></canvas>

  <!-- Install-help bar, hidden until privacy accepted -->
  <details class="install-help gate-hide" id="install-help" data-dismiss-key="latw-install-help">
    <summary class="install-help__wrap">
      <div class="install-help__summary" role="button" aria-expanded="false">
        <svg class="caret" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path d="M7 10l5 5 5-5z"></path></svg>
        <strong>Tap for a reminder for how to save this app to your home screen!</strong>
        <button class="install-help__close" type="button" title="Hide">‚úñ</button>
      </div>
    </summary>
    <div class="install-help__panel" id="install-help-panel" aria-live="polite">
      <div class="install-help__box" id="ios-safari" hidden>
        <h4>iPhone or iPad using Safari</h4>
        <ol class="install-help__steps">
          <li>Tap the Share icon</li><li>Choose <em>Add to Home Screen</em></li><li>Tap <em>Add</em></li>
        </ol>
      </div>
      <div class="install-help__box" id="ios-chrome" hidden>
        <h4>iPhone or iPad using Chrome</h4>
        <ol class="install-help__steps">
          <li>Tap the Share icon</li><li>Select <em>Add to Home Screen</em></li><li>Tap <em>Add</em></li>
        </ol>
      </div>
      <div class="install-help__box" id="android-chrome" hidden>
        <h4>Android using Chrome</h4>
        <ol class="install-help__steps">
          <li>Tap the menu</li><li>Choose <em>Install app</em> or <em>Add to Home screen</em></li><li>Confirm</li>
        </ol>
      </div>
      <div class="install-help__box" id="android-samsung" hidden>
        <h4>Android using Samsung Internet</h4>
        <ol class="install-help__steps">
          <li>Tap the menu</li><li>Select <em>Add page to</em> ‚Üí <em>Home screen</em></li><li>Confirm</li>
        </ol>
      </div>
      <div class="install-help__box" id="other-browsers" hidden>
        <h4>Other browsers</h4>
        <p>Look in the menu for <em>Install</em> or <em>Add to Home Screen</em></p>
      </div>
      <p class="install-help__tips">Installing adds an icon to your Home Screen and makes it behave like an app</p>
      <button type="button" id="install-help-never" class="install-help__never">Don‚Äôt show this again</button>
    </div>
  </details>

  <!-- Privacy / Courtesy overlay -->
  <section id="courtesyOverlay" role="dialog" aria-labelledby="courtesyTitle" aria-modal="true" style="position:fixed; inset:0; display:none; place-items:center; z-index:9999; background:rgba(0,0,0,.45);">
    <div class="courtesy-card" style="width:min(560px,92%); background:#fff; color:#3c3c3c; border-radius:18px; box-shadow:0 12px 40px rgba(0,0,0,.18); padding:22px; text-align:left;">
      <h2 id="courtesyTitle" style="margin:0 0 8px; color:#237e6b; font-family:'Baloo 2',system-ui; font-size:20px;">Thanks for supporting this work</h2>
      <p style="margin:6px 0 14px; color:#666;">This app is for customers of Playful Heart Parenting. Please keep this link private.</p>
      <label class="courtesy-check" style="display:flex; align-items:center; gap:10px; margin:6px 0 12px;">
        <input type="checkbox" id="courtesyAck" />
        <span>Got it! üíû</span>
      </label>
      <button id="courtesyContinue" disabled style="width:100%; padding:12px 14px; border:0; border-radius:14px; font-weight:700; cursor:not-allowed; background:#b24627; color:#fff;">
        Continue
      </button>
    </div>
  </section>

  <!-- App -->
  <div id="appWrap">
    <header>
      <img class="brand" src="./LATWlogo.png" alt="Laughing All the Way ‚Äî Advent Calendar from Playful Heart Parenting" />
      <div class="controls">
        <button class="pill" id="installBtn">Install</button>
      </div>
    </header>

    <!-- ‚≠ê Bonus info bar + Bonus Vault -->
    <header id="bonusBar" class="latw-sticky hidden" data-latw-bonus>
      <div class="latw-sticky__inner">
        <span class="latw-emoji" aria-hidden="true">üéÅ</span>
        <span class="latw-sticky__text">
          Look for ‚≠ê bonus icons for optional extra games! Open this button anytime for more fun.
        </span>
        <button id="bonusVaultBtn" class="latw-btn" type="button">Bonus Fun!</button>
      </div>
    </header>
    <div id="bonusVaultModal" class="latw-modal" aria-hidden="true" role="dialog" aria-labelledby="vaultTitle" data-latw-bonus></div>

    <main>
      <!-- Welcome screen -->
      <section class="welcome-card" id="welcomeCard">
        <h1>Welcome to <em>Laughing All the Way!</em></h1>
        <p>Tap a square each day to reveal your game of the day as you count down to Christmas! This advent calendar rotates through several games with a few prompts for each day. No rules, no winners or losers, and no wrong way to play. The goal is simple: family fun and connection!</p>

        <h2>How to Play Each Game</h2>
        <ul>
          <li><strong>Who Can Sound Like</strong> ‚Äî Use just sounds to act out the prompt!</li>
          <li><strong>You Are</strong> ‚Äî Use your body, sounds, and facial expressions to act out the prompt.</li>
          <li><strong>Make This Face</strong> ‚Äî Create a dramatic facial expression for the prompt. Try not to make any sounds, just freeze your face!</li>
          <li><strong>Would You Rather</strong> ‚Äî Take turns answering each question. Explain your answers for extra fun!</li>
          <li><strong>Plot Twist Story</strong> ‚Äî Use the title to make up a story together and try to weave in the three plot twists included.</li>
          <li><strong>Truth or Merry Mischief</strong> ‚Äî Choose TRUTH and answer the question, or do the MERRY MISCHIEF challenge if you dare!</li>
          <li><strong>Merry Mad Libs</strong> ‚Äî Fill in the blanks with your silliest words, then tap to read the silly result!</li>
        </ul>

        <p class="instructions">Look for ‚≠ê on certain days for an optional bonus game!</p>

        <button class="start-btn" id="startBtn">Start the Countdown!</button>
        <p class="download-note">
          Want the printable version too? Here ya go!
          <br><a href="Laughing All the Way printable 2025.pdf" download rel="noopener" class="download-link">Download the PDF</a>
        </p>
      </section>

      <!-- Calendar grid -->
      <section class="grid" id="grid" style="display:none;"></section>
    </main>

  </div>

  <footer>
    ¬© 2025 Mia Wisinski, Playful Heart Parenting. For personal use by purchasers only.
  </footer>

  <!-- Viewer -->
  <div class="viewer" id="viewer" aria-modal="true" role="dialog">
    <div class="card" id="card">
      <div style="display:flex; align-items:center; gap:.35rem; justify-content:flex-end">
        <button class="close" id="closeBtn">Close</button>
      </div>
      <h2 id="cardTitle"></h2>
      <div class="prompt" id="cardBody"></div>
    </div>
  </div>

  <!-- Main Script -->
  <script>
  /* ----------------- Content: Days 1‚Äì24 ----------------- */
  const DAYS = [
    { title: "Who Can Sound Like", prompts: [
      "an elf who just burned their tongue a little bit on hot chocolate",
      "a baby polar bear trying to growl for the first time",
      "reindeer hoofs on the roof (and the reindeer are super excited because it‚Äôs the first house of the night!)"
    ]},
    { title: "Make This Face", prompts: [
      "You just looked up in the sky and saw Santa‚Äôs sleigh and he waved at you!",
      "You‚Äôre just about to open a giant present but then the box starts wiggling and making strange noises‚Ä¶",
      "Something just poked you in the back and you turn around to see it was a reindeer‚Äôs antler and Rudolph is staring at you!"
    ]},
    { title: "You Are", prompts: [
      "A baby penguin waddling across the slippery ice for the first time",
      "A tired but happy elf who just made 3,645 toys and is collapsing on the floor from exhaustion",
      "The star getting lifted up and put on top of the tree ‚Äî so excited to show off how bright it can shine"
    ]},
    { title: "Would You Rather", prompts: [
      "‚Ä¶wear jingle bells around your ankles all year long that jingle wherever you go OR hear the song ‚ÄúJingle Bells‚Äù on repeat all year round?",
      "‚Ä¶get around everywhere by riding in Santa‚Äôs sleigh OR by riding on a reindeer?",
      "‚Ä¶have a magical mug of hot cocoa that refills itself whenever you snap OR a magical plate of sugar cookies that refills whenever you say ‚ÄúCookies please!‚Äù?"
    ]},
    { title: "Plot Twist Story ‚Äî The Very Shy Snowman", prompts: [
      "Suddenly, a little girl ran by. She was carrying a giant box of cookies, but then she tripped and the cookies went flying‚Ä¶ Where did they land?",
      "Just then, a sweet little old lady walked up and said, ‚ÄúPardon me, but I think this belongs to you!‚Äù She was holding a sparkly, golden ornament with words painted on it that said‚Ä¶",
      "Then a voice started singing ‚ÄúWe Wish You A Merry Christmas.‚Äù It was the most beautiful singing anyone had ever heard. It was getting louder and louder, until they realized where it was coming from. Who was it?"
    ]},
    { title: "Who Can Sound Like", prompts: [
      "a grandma taking a bite of the cookies she just baked and realizing she forgot the sugar!",
      "Santa laughing but he‚Äôs trying to laugh quietly so he doesn‚Äôt wake up the sleeping kids...",
      "a squirrel who accidentally fell asleep in a Christmas tree at the tree farm and is waking up in some random person‚Äôs house!"
    ]},
    { title: "Make This Face", prompts: [
      "The snowman you just finished building just said, ‚ÄúSorry to bother you, but do you think you could please make my nose a little less crooked?‚Äù",
      "You‚Äôre smelling a very strong pine tree smell and you just realized it‚Äôs coming from your own armpit!?",
      "You just knocked an ornament off the tree and caught it JUST before it hit the ground!"
    ]},
    { title: "You Are", prompts: [
      "A snowflake falling down from the sky and landing on top of a giant snowman and being so excited to be part of it",
      "A cold candy cane that accidentally got left out in the snow and then a little kid finally comes and picks you up",
      "A jar of sprinkles getting sprinkled all over the Christmas cookies"
    ]},
    { title: "Would You Rather", prompts: [
      "‚Ä¶be able to build a snowman that lasts year round even when it‚Äôs hot outside OR make paper snowflakes that turn into real snowflakes?",
      "‚Ä¶be able to snap your fingers and make it snow outside OR snap your fingers and automatically decorate the whole neighborhood?",
      "‚Ä¶your laugh sound like a deep, jolly Santa laugh OR like a little silly high-pitched elf?"
    ]},
    { title: "Plot Twist Story ‚Äî The Case of the Missing Christmas Pajamas", prompts: [
      "Just then, a little squeaky, mischievous laugh could be heard from under a nearby bush. Who was it?",
      "‚ÄúHelp!! HELP! I don‚Äôt know how to stop this thing‚Äù shouted a voice from across the road. They turned to see a man on a snowboard being pulled by a donkey who was galloping as fast as he could...",
      "Suddenly, the smell of cinnamon and apple cider wafted through the air, and that could only mean one thing..."
    ]},
    { title: "Who Can Sound Like", prompts: [
      "Two turtle doves cooing back and forth telling each other a funny story",
      "A gingerbread cookie that comes to life and is so excited it‚Äôs real",
      "Mrs. Claus humming a carol but then she accidentally sits down on a pinecone!"
    ]},
    { title: "Make This Face", prompts: [
      "You just realized you ripped your pants right down the bottom when you were making a snow angel!",
      "It‚Äôs snowing outside and you stick out your tongue to try to catch the snowflakes but then you realize it‚Äôs actually snowing mini marshmallows",
      "You just realized it‚Äôs so cold outside you have little snotsicles hanging out of your nose..."
    ]},
    { title: "You Are", prompts: [
      "An ice skater doing the most amazing ice skating trick of all time",
      "A snowball rolling down a hill, getting bigger and bigger until you crash in a big fluffy Christmas tree",
      "A gingerbread cookie that is sad nobody picked it off the plate and then it finally gets picked"
    ]},
    { title: "Would You Rather", prompts: [
      "‚Ä¶have everything you eat for a day be gingerbread spice flavored OR turn into a magical gingerbread cookie for a whole day?",
      "‚Ä¶have to change your name to Frosty OR have the song ‚ÄúFrosty the Snowman‚Äù play whenever you walk into the room?",
      "‚Ä¶have to permanently dye your hair to be candy cane striped OR only wear candy cane striped clothes year-round?"
    ]},
    { title: "Plot Twist Story ‚Äî The Day That Rudolph‚Äôs Nose Couldn‚Äôt Stop Changing Colors", prompts: [
      "‚ÄúOh dear, this is a catastrophe!!‚Äù cried a voice from across the room. ‚ÄúI‚Äôve lost my lucky candy cane I‚Äôve been saving for 50 years!‚Äù Who was it?",
      "A gust of cold wind blew in along with a note that had a riddle on it that read: ‚ÄúNoses are red, gumdrops are blue, what is the thing that makes you truly YOU?‚Äù",
      "Suddenly, an elf named Larry came running up, out of breath, saying, ‚ÄúI‚Äôve done it!! My invention finally works! Quick! Come see, come see!!‚Äù"
    ]},
    { title: "Who Can Sound Like", prompts: [
      "A professional chicken caroler bawking ‚ÄúJingle Bells‚Äù for a crowd",
      "A little kid tasting a candy cane for the first time",
      "A french hen looking everywhere for its other two best french-hen-friends because they‚Äôre playing hide and seek"
    ]},
    { title: "Make This Face", prompts: [
      "You just smelled the most delicious gingerbread cookies baking in the oven and they‚Äôre going to be done in five minutes",
      "You just burped and it sounded JUST like ‚ÄúSilent Night‚Äù and everyone is very impressed, especially yourself",
      "You‚Äôre almost asleep on Christmas Eve but you THINK you just heard sleigh bells jingling outside"
    ]},
    { title: "You Are", prompts: [
      "A lucky, but stinky, pair of Christmas socks getting washed in the washing machine",
      "The one lightbulb on the Christmas tree that keeps going out because you‚Äôre just so tired",
      "Jack Frost running around nipping at everyone‚Äôs nose (no actual nose-nipping please)"
    ]},
    { title: "Would You Rather", prompts: [
      "‚Ä¶live in a gingerbread house OR live next door to Santa‚Äôs workshop?",
      "‚Ä¶instantly grow a Santa Claus-looking beard every time someone says your name (and then it disappears after 30 seconds) OR have your nose light up like Rudolph‚Äôs for two minutes every time someone says your name?",
      "‚Ä¶have a partridge that lives in a little pear tree and squawks to wake you up every morning OR have three french hens that live in your bathroom and are always getting in your way?"
    ]},
    { title: "Who Can Sound Like", prompts: [
      "A jolly mommy snow owl hooting for her babies to come home for dinner",
      "A donkey singing its favorite Christmas carol (but can only sing the words ‚Äúhee-haw‚Äù)",
      "Six geese a-laying eggs and honking to each other about how proud they are"
    ]},
    { title: "Make This Face", prompts: [
      "You just looked in the mirror and realized you‚Äôve grown pointy elf ears and you‚Äôre not sure if you‚Äôre dreaming or not",
      "You just opened up a gift from your Great Aunt Mildred and it‚Äôs a Christmas sweater that has her own face embroidered on it and it lights up and plays polka music when you press the button",
      "Your nose just started lighting up red like Rudolph"
    ]},
    { title: "Would You Rather", prompts: [
      "‚Ä¶shrink down to the size of an ornament OR grow to the size of a Christmas tree for a day?",
      "‚Ä¶have tiny snowflakes flutter down all around you every time you feel sleepy OR have sprinkles sprinkle down around you whenever you get excited?",
      "‚Ä¶be the official cookie taste-tester of the North Pole OR be the official toy-tester at Santa‚Äôs workshop?"
    ]},
    { title: "Truth or Merry Mischief", pairs: [
      { truth: "If you could only ever listen to one Christmas song, what would you choose?", dare: "Step outside and sing ‚ÄúIt‚Äôs the most wonderful time of the year‚Äù at the top of your lungs!" },
      { truth: "What‚Äôs the best Christmas gift you ever got OR the best gift you ever gave someone?", dare: "Build a snowman out of pillows and give it a name." },
      { truth: "If you were an elf, what‚Äôs your name and job in Santa‚Äôs workshop?", dare: "Act like a partridge in a pear tree. Flap and squawk!" },
      { truth: "Are you a candy cane, a gingerbread cookie, or peppermint bark? Explain!", dare: "Run around the room and say in a gingerbread voice, ‚ÄúRun, run as fast as you can You can‚Äôt catch me, I‚Äôm the gingerbread man!‚Äù" },
      { truth: "If you could only eat one holiday food for the rest of your life, what would it be?", dare: "Make up an original holiday joke!" }
    ]},
    { title: "Merry Mad Libs" }
  ];

  /* ----------------- Elements ----------------- */
  const grid = document.getElementById('grid');
  const viewer = document.getElementById('viewer');
  const cardTitle = document.getElementById('cardTitle');
  const cardBody  = document.getElementById('cardBody');
  const closeBtn  = document.getElementById('closeBtn');
  let currentOpenDay = null;

  // Viewed tiles persistence
  const OPENED_KEY = 'latw_opened_days_v1';
  function getOpened(){ try { return new Set(JSON.parse(localStorage.getItem(OPENED_KEY) || '[]')); } catch(e){ return new Set(); } }
  function saveOpened(set){ try { localStorage.setItem(OPENED_KEY, JSON.stringify([...set])); } catch(e){} }
  let openedDays = getOpened();

  function addCheckButton(day){
    const tile = document.querySelector(`.tile[data-day="${day}"]`);
    if (!tile || tile.querySelector('.tile-check')) return;
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'tile-check';
    btn.setAttribute('aria-label', 'Toggle opened');
    btn.textContent = '‚úì';
    btn.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      if (isViewed(day)) unmarkViewed(day); else markViewed(day);
    });
    tile.appendChild(btn);
  }
  function removeCheckButton(day){
    document.querySelector(`.tile[data-day="${day}"]`)?.querySelector('.tile-check')?.remove();
  }
  function markViewed(day){
    openedDays.add(day);
    saveOpened(openedDays);
    const tile = document.querySelector(`.tile[data-day="${day}"]`);
    tile?.classList.add('viewed');
    tile?.setAttribute('aria-pressed','true');
    addCheckButton(day);
  }
  function applyViewedStates(){
    openedDays.forEach(d => {
      const tile = document.querySelector(`.tile[data-day="${d}"]`);
      tile?.classList.add('viewed');
      tile?.setAttribute('aria-pressed','true');
      addCheckButton(d);
    });
  }
  function isViewed(day){ return openedDays.has(day); }
  function unmarkViewed(day){
    openedDays.delete(day);
    saveOpened(openedDays);
    const tile = document.querySelector(`.tile[data-day="${day}"]`);
    tile?.classList.remove('viewed');
    tile?.setAttribute('aria-pressed','false');
    removeCheckButton(day);
  }

  /* ----------------- Tiles ----------------- */
  function makeTile(i){
    const day = i + 1;
    const el = document.createElement('button');
    el.className = 'tile';
    el.type = 'button';
    el.textContent = day;
    el.setAttribute('data-day', String(day));
    el.setAttribute('aria-pressed', openedDays.has(day) ? 'true' : 'false');
    if (openedDays.has(day)) el.classList.add('viewed');
    el.addEventListener('click', () => openViewer(day));
    return el;
  }
  function renderGrid(){
    grid.innerHTML = '';
    for (let i=0; i<25; i++) grid.appendChild(makeTile(i));
    applyViewedStates();
  }
  renderGrid();

  // Welcome screen toggle
  const welcomeCard = document.getElementById("welcomeCard");
  const gridSection = document.getElementById("grid");
  const startBtn = document.getElementById("startBtn");
  const bonusBar = document.getElementById('bonusBar');
  bonusBar?.classList.add('hidden');
  gridSection.style.display = "none";

  try {
    if (new URLSearchParams(location.search).get('reset') === '1') {
      localStorage.removeItem('latw_started_v1');
    }
  } catch(e){}

  try {
    if (localStorage.getItem('latw_started_v1') === 'yes') {
      welcomeCard.style.display = "none";
      gridSection.style.display = "grid";
      bonusBar?.classList.remove('hidden');
      setTimeout(() => window.__initLATWBonus?.(), 0);
    }
  } catch(e){}

  if (startBtn) {
    startBtn.addEventListener("click", () => {
      welcomeCard.style.display = "none";
      gridSection.style.display = "grid";
      bonusBar?.classList.remove('hidden');
      try { localStorage.setItem('latw_started_v1', 'yes'); } catch(e){}
      setTimeout(() => window.__initLATWBonus?.(), 0);
    });
  }

  /* ----------------- Generator helpers ----------------- */
  function pickNext(indexes){
    const i = Math.floor(Math.random() * indexes.length);
    return indexes.splice(i,1)[0];
  }
  function prefixFor(title){
    const t = (title || "").toLowerCase();
    if (t.includes("who can sound like")) return "Who can sound like‚Ä¶";
    if (t.includes("make this face"))     return "Make this face‚Ä¶";
    if (t === "you are" || t.includes("you are")) return "You are‚Ä¶";
    if (t.includes("would you rather"))   return "Would you rather‚Ä¶";
    if (t.includes("plot twist"))         return "Plot twist‚Ä¶";
    return title || "Today‚Äôs prompt";
  }
  function normalizePrompt(p){ return (p || "").replace(/^[.‚Ä¶\s]+/, ""); }
  function rulesFor(title){
    const t = (title || "").toLowerCase();
    if (t.includes("who can sound like"))
      return "Take turns using just sounds to act out the prompt.";
    if (t.includes("you are"))
      return "Use your body, sounds, and facial expressions to act out the prompt.";
    if (t.includes("make this face"))
      return "Make a dramatic facial expression for the prompt. No sound, just freeze your face.";
    if (t.includes("plot twist"))
      return "Use this title to make up a silly story together. Tap to include the three plot twists below!";
    if (t.includes("would you rather"))
      return "Take turns answering. Explain your answers for extra fun.";
    if (t.includes("merry mischief"))
      return "Pick TRUTH or MERRY MISCHIEF. Do the challenge if you dare.";
    return "";
  }

  function renderPromptGenerator(dayIndex){
    const day = DAYS[dayIndex];
    const title = day.title || "Today‚Äôs Prompts";
    cardTitle.textContent = `Day ${dayIndex+1} ‚Äî ${title}`;

    const rules = rulesFor(title);
    const titlePrefix = prefixFor(title);

    // Day 23: Truth or Merry Mischief
    if (day.pairs){
      const truths    = day.pairs.map(p => p.truth);
      const mischiefs = day.pairs.map(p => p.dare);
      const truthIdxs    = Array.from({length: truths.length}, (_,i)=>i);
      const mischiefIdxs = Array.from({length: mischiefs.length}, (_,i)=>i);

      cardBody.innerHTML = `
        <div class="prompt">
          ${rules ? `<div class="instructions">${rules}</div>` : ``}
          <div class="madlib-actions" style="margin:.2rem 0 .6rem">
            <button class="madlib-btn" id="drawTruth">Draw TRUTH</button>
            <button class="madlib-btn secondary" id="drawMischief">Draw MERRY MISCHIEF</button>
            <button class="madlib-btn" id="drawEither">Surprise me</button>
          </div>
          <div id="genOutput" class="madlib-output" style="display:none"></div>
        </div>
      `;

      const out = document.getElementById('genOutput');
      function drawTruth(){
        if (!truthIdxs.length){ out.textContent = "All TRUTH cards used."; out.style.display="block"; return; }
        const idx = pickNext(truthIdxs);
        out.textContent = `TRUTH:\n${truths[idx]}`;
        out.style.display = "block";
      }
      function drawMischief(){
        if (!mischiefIdxs.length){ out.textContent = "All MERRY MISCHIEF cards used."; out.style.display="block"; return; }
        const idx = pickNext(mischiefIdxs);
        out.textContent = `MERRY MISCHIEF:\n${mischiefs[idx]}`;
        out.style.display = "block";
      }
      function drawEither(){
        const total = truthIdxs.length + mischiefIdxs.length;
        if (!total){ out.textContent = "Way to play! That‚Äôs a wrap for today!"; out.style.display="block"; return; }
        const roll = Math.random() * total;
        if (roll < truthIdxs.length) drawTruth(); else drawMischief();
      }
      document.getElementById('drawTruth').onclick   = drawTruth;
      document.getElementById('drawMischief').onclick= drawMischief;
      document.getElementById('drawEither').onclick  = drawEither;
      return;
    }

    // Regular generators (3 prompts)
    const remaining = [0,1,2];
    const isPlotTwist = (title.toLowerCase().includes("plot twist"));
    const nextLabel = isPlotTwist ? "Next twist!" : "Next prompt!";
    let plotStoryName = "";
    if (isPlotTwist){
      plotStoryName = title.replace(/^Plot Twist Story\s*‚Äî\s*/i, "").trim();
    }

    cardBody.innerHTML = `
      <div class="prompt">
        ${rules ? `<div class="instructions">${rules}</div>` : ``}
        ${isPlotTwist ? `<div class="madlib-output" style="margin-top:.2rem; font-weight:700; font-family:'Baloo 2', system-ui; color:var(--teal)">${plotStoryName}</div>` : ``}
        <div id="genOutput" class="madlib-output" style="display:none"></div>
        <div class="madlib-actions" style="margin-top:.6rem">
          <button class="madlib-btn" id="nextPrompt">${nextLabel}</button>
        </div>
      </div>
    `;

    const out = document.getElementById('genOutput');
    const btn = document.getElementById('nextPrompt');

    function next(){
      if(!remaining.length){
        out.innerHTML = `Way to play! That‚Äôs a wrap for today!`;
        out.style.display = "block";
        btn.style.display = "none";

        // Inline bonus CTA if today has one
        try {
          const placement = window.__LATW_PLACEMENT || {};
          const bonusId = placement[(dayIndex+1).toString()] || placement[dayIndex+1];
          if (bonusId) {
            const title = (window.__LATW_BONUS_COPY && window.__LATW_BONUS_COPY[bonusId]?.title) || 'Bonus';
            out.insertAdjacentHTML('beforeend',
              `<div class="madlib-actions" style="margin-top:.85rem">
                 <button class="madlib-btn latw-star-inline" type="button"
                         data-bonus-id="${bonusId}"
                         aria-label="Open bonus ${title}">
                   ‚≠ê Tap to get a bonus game for today!
                 </button>
               </div>`);
          }
        } catch(e){}
        return;
      }

      const idx = pickNext(remaining);
      const text = normalizePrompt(day.prompts[idx]);
      if (isPlotTwist){
        out.innerHTML = `${text}`;
      } else {
        out.innerHTML = `<em>${titlePrefix}</em> ${text}`;
      }
      out.style.display = "block";
    }

    btn.onclick = next;
    next();
  }

  /* ----------------- Viewer ----------------- */
  function openViewer(day){
    viewer.classList.add('open');
    currentOpenDay = day;

    if (day === 24){
      cardTitle.textContent = "Day 24 ‚Äî Merry Mad Libs";
      renderMadLibsForm();
      markViewed(day);
      return;
    }

    if (day === 25){
      cardTitle.textContent = "Merry Christmas!";
      cardBody.innerHTML = `
        <div class="prompt">
          <p>Thank you for playing along all month long. What an honor and joy to share this season of laughter and connection with you!</p>
          <p>If you'd like to carry this playful energy into the new year, check out more fun ideas and connection games inside the <strong>Playful Heart Parenting Bundle</strong>.</p>
          <p><a href="https://www.playfulheartparenting.com/bundle-little-moments-tap-into-play-apps" target="_blank" rel="noopener" class="cta-link">Tap here to explore the full bundle & save over 40%</a></p>
          <p style="margin-top:1rem;font-weight:600;">Cheering you on always!</p>
          <p style="margin-bottom:0;"><em>Love,<br>Mia</em></p>
        </div>
      `;
      markViewed(day);
      return;
    }

    renderPromptGenerator(day - 1);
    markViewed(day);
  }

  function closeViewer(){
    viewer.classList.remove('open');
  }
  viewer.addEventListener('click', (e) => { if (e.target === viewer) closeViewer(); });
  closeBtn.addEventListener('click', closeViewer);
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeViewer(); });
  // make closeViewer callable from the bonus module
window.__closeViewer = closeViewer;


  /* ----------------- Courtesy / Privacy Gate ----------------- */
  const COURTESY_KEY = 'latw_courtesy_v1';
  const courtesyOverlay = document.getElementById('courtesyOverlay');
  const courtesyAck = document.getElementById('courtesyAck');
  const courtesyContinue = document.getElementById('courtesyContinue');
  const appWrap = document.getElementById('appWrap');

  function showGate(){
    appWrap.classList.add('blur');
    courtesyOverlay.style.display = 'grid';
  }
  function hideGate(){
    appWrap.classList.remove('blur');
    courtesyOverlay.style.display = 'none';
  }
  if (localStorage.getItem(COURTESY_KEY) !== 'yes') { showGate(); }
  courtesyAck.addEventListener('change', () => {
    courtesyContinue.disabled = !courtesyAck.checked;
    courtesyContinue.style.cursor = courtesyAck.checked ? 'pointer' : 'not-allowed';
  });
  courtesyContinue.addEventListener('click', () => {
    if (!courtesyAck.checked) return;
    localStorage.setItem(COURTESY_KEY, 'yes');
    hideGate();
    document.getElementById('install-help')?.classList.remove('gate-hide');
  });
  if (localStorage.getItem(COURTESY_KEY) === 'yes') {
    document.getElementById('install-help')?.classList.remove('gate-hide');
  }

  /* ----------------- Install Help ----------------- */
  (function(){
    const root = document.getElementById('install-help');
    const panel = document.getElementById('install-help-panel');
    if (!root || !panel) return;

    const closeBtn = root.querySelector('.install-help__close');
    const providedKey = root.getAttribute('data-dismiss-key');
    const key = providedKey && providedKey.trim().length ? providedKey : 'latw-install-help::' + location.pathname;

    try {
      if (new URLSearchParams(location.search).get('reset_install_tip') === '1') {
        localStorage.removeItem(key);
      }
    } catch(e) {}

    if(localStorage.getItem(key)==='1'){ root.classList.add('hidden'); return; }

    closeBtn.addEventListener('click', function(e){
      e.preventDefault(); e.stopPropagation();
      localStorage.setItem(key,'1');
      root.classList.add('hidden');
    });

    const neverBtn = document.getElementById('install-help-never');
    if(neverBtn){
      neverBtn.addEventListener('click', function(){
        localStorage.setItem(key,'1');
      root.classList.add('hidden');
      });
    }

    const ua = navigator.userAgent || '';
    const isIOS = /iPad|iPhone|iPod/.test(ua) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
    const isAndroid = /Android/i.test(ua);
    const isSamsung = /SamsungBrowser/i.test(ua);
    const isCriOS = /CriOS/i.test(ua);
    const isFxiOS = /FxiOS/i.test(ua);
    const isSafari = isIOS && /Safari/i.test(ua) && !isCriOS && !isFxiOS;
    const isChromeAndroid = isAndroid && /Chrome/i.test(ua) && !isSamsung;

    function show(id){ const el = document.getElementById(id); if(el) el.hidden = false; }

    if(isIOS && isSafari){ show('ios-safari'); }
    else if(isIOS && isCriOS){ show('ios-chrome'); }
    else if(isAndroid && isSamsung){ show('android-samsung'); }
    else if(isChromeAndroid){ show('android-chrome'); }
    else { show('other-browsers'); }

    const label = root.querySelector('.install-help__summary strong');
    const summaryBtn = root.querySelector('.install-help__summary');
    const closedText = 'Tap for a reminder on saving this app to your home screen';
    const openText = 'Hide instructions';
    root.addEventListener('toggle', function(){
      const exp = root.open ? 'true' : 'false';
      summaryBtn && summaryBtn.setAttribute('aria-expanded', exp);
      if(label){ label.textContent = root.open ? openText : closedText; }
    });
  })();

  /* ----------------- Snowfall ----------------- */
  const canvas = document.getElementById('snow');
  const ctx = canvas.getContext('2d');
  function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
  addEventListener('resize', resize); resize();
  const flakes = Array.from({length: Math.min(200, Math.floor(innerWidth/5))},
    () => ({ x: Math.random()*innerWidth, y: Math.random()*innerHeight, r: Math.random()*2+0.7, s: Math.random()*0.7+0.2 })
  );
  (function snow(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = 'rgba(255,255,255,0.95)';
    for (const f of flakes){
      ctx.beginPath(); ctx.arc(f.x, f.y, f.r, 0, Math.PI*2); ctx.fill();
      f.y += f.s; f.x += Math.sin(f.y*0.01);
      if (f.y > canvas.height) { f.y = -6; f.x = Math.random()*canvas.width; }
    }
    requestAnimationFrame(snow);
  })();

  /* ----------------- Install button (A2HS) ----------------- */
  const isStandalone =
    window.matchMedia('(display-mode: standalone)').matches ||
    window.navigator.standalone === true;
  const installBtn = document.getElementById('installBtn');
  let deferredPrompt;

  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    if (!isStandalone && installBtn) installBtn.style.display = 'inline-block';
  });

  if (installBtn) {
    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      installBtn.style.display = 'none';
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null;
    });
  }

  /* ----------------- Day 24: Mad Libs mini-app ----------------- */
  const MADLIBS_FIELDS = [
    {key:"f1",label:"1) Exclamation"},
    {key:"f2",label:"2) Something you can feel"},
    {key:"f3",label:"3) Body part"},
    {key:"f4",label:"4) Verb ending in ‚Äúing‚Äù"},
    {key:"f5",label:"5) Color"},
    {key:"f6",label:"6) Color"},
    {key:"f7",label:"7) Number"},
    {key:"f8",label:"8) Animal"},
    {key:"f9",label:"9) Something you can hold"},
    {key:"f10",label:"10) Food"},
    {key:"f11",label:"11) Feeling"},
    {key:"f12",label:"12) Someone famous"},
    {key:"f13",label:"13) Part of a house"},
    {key:"f14",label:"14) Body part (plural)"},
    {key:"f15",label:"15) Body part (plural)"},
    {key:"f16",label:"16) Verb ending in ‚Äúing‚Äù"},
    {key:"f17",label:"17) Verb"},
    {key:"f18",label:"18) Food"},
    {key:"f19",label:"19) Adjective"},
    {key:"f20",label:"20) Verb"}
  ];

  const MADLIBS_TEMPLATE =
`‚Äú{1}!‚Äù Do you feel that little {2} in the air? It sure is starting to feel like Christmas! I can feel it in my {3} ‚Äî that jolly, warm excitement for the holiday season.

Why, just yesterday, I was {4} around downtown and I was dazzled by all the {5} and {6} decorations. I even saw a {7}-foot-tall inflatable {8} wearing a Santa outfit, holding a {9}! Instant holiday spirit!

Then I stopped to grab a nice hot cup of {10}-nog and felt {11} when I heard a remix of ‚ÄúJolly Old {12}‚Äù and ‚ÄúUp on the {13}.‚Äù Before I knew it, my {14} were dancing by themselves and I was singing at the top of my {15}. Nobody minded ‚Äî they were {16} along too!

My favorite part of the season is time with family. I love {17} together while eating spiced {18} and laughing about all the {19} memories of Christmases past.

I hope you have a wonderful holiday ‚Äî and don‚Äôt forget to {20} as much as you can in the new year!`;

  function renderMadLibsForm(){
    const fieldsHTML = MADLIBS_FIELDS.map(f=>`
      <div class="madlib-field">
        <label for="${f.key}">${f.label}</label>
        <input id="${f.key}" type="text">
      </div>`).join("");

    cardBody.innerHTML=`
      <div class="instructions">
        Pick the silliest words you can think of. Fill in the blanks below, then read the final result out loud!
      </div>
      <form class="madlib-form" id="madlibForm">
        <div class="madlib-grid">${fieldsHTML}</div>
        <div class="madlib-actions">
          <button type="submit" class="madlib-btn">Make My Story</button>
        </div>
      </form>
      <div id="madlibOutput" class="madlib-output" style="display:none"></div>
      <div class="madlib-actions" id="madlibEditBar" style="display:none">
        <button class="madlib-btn secondary" id="madlibEditBtn" type="button">Edit Answers</button>
      </div>
    `;

    const form=document.getElementById("madlibForm");
    form.addEventListener("submit",e=>{
      e.preventDefault();
      const data={};
      MADLIBS_FIELDS.forEach(f=>{
        data[f.key]=(document.getElementById(f.key).value||"_____").trim();
      });
      renderMadLibsStory(data);
    });

    document.getElementById("madlibEditBtn").addEventListener("click",()=>{
      document.getElementById("madlibOutput").style.display="none";
      document.getElementById("madlibEditBar").style.display="none";
      form.style.display="grid";
    });
  }
  function escapeHTML(str){
    return String(str)
      .replace(/&/g,"&amp;")
      .replace(/</g,"&lt;")
      .replace(/>/g,"&gt;")
      .replace(/"/g,"&quot;")
      .replace(/'/g,"&#39;");
  }
  function renderMadLibsStory(values){
    let story = MADLIBS_TEMPLATE;
    for(let i=1; i<=20; i++){
      const raw  = values[`f${i}`] || "_____";
      const safe = escapeHTML(raw);
      const bold = `<strong>${safe}</strong>`;
      story = story.split(`{${i}}`).join(bold);
    }
    const out = document.getElementById("madlibOutput");
    out.innerHTML = story;
    out.style.display = "block";
    document.getElementById("madlibEditBar").style.display = "flex";
    document.getElementById("madlibForm").style.display = "none";
    document.querySelector(".instructions")?.style.setProperty("display", "none");
  }
  </script>

  <!-- ‚≠ê Bonus Module -->
  <script>
  (function () {
    const BONUS_COPY = {
      'serious-santa': { title:'Serious Santa', text:'Have a staring contest while saying Ho-Ho-Ho in different silly ways but without laughing!' },
      'holly-handshake': { title:'Holly Jolly Handshake', text:'Create a creative holiday-themed handshake. Ideas to incorporate: candy-cane claps, snowman snaps, jingle-bell jumps.' },
      'jingle-jargon': { title:'Jingle Jargon', text:'Make up an elf language. Have a gibberish-elf conversation or try to translate it.' },
      'tinsel-twisters': { title:'Tinsel Twisters', text:'Say these tongue twisters five times fast: Santa‚Äôs short suit shrunk ‚Ä¢ Red lolly yellow lolly ‚Ä¢ Toy boat.' },
      'mind-meld': { title:'Holiday Mind Meld', text:'Count down from three, then try to say the same holiday word at the same time. Keep going until you match!' },
      'silent-singing': { title:'Silent Night Singing', text:'Lip-sync a carol without sound while others guess. Bonus points for an extra expressive face!' },
      'santa-says': { title:'Santa Says', text:'Play Simon Says but as Santa Says. Say ‚ÄúHo Ho Ho, Santa says‚Ä¶‚Äù before each instruction.' },
      'ventriloquism': { title:'Very Merry Ventriloquism', text:'Try to say these holiday phrases while smiling without moving your lips: KRIS KRINGLE ‚Ä¢ I LIKE SINGING SONGS ‚Ä¢ DO YOU LIKE CANDY CANES?' },
      'bawk-carol': { title:'Bawk That Carol', text:'Bawk a Christmas carol like a chicken while others guess the song. Try your best to keep a straight face.' }
    };

    const PLACEMENT = {
      3:'serious-santa',
      6:'holly-handshake',
      8:'ventriloquism',
      10:'jingle-jargon',
      13:'tinsel-twisters',
      16:'mind-meld',
      19:'silent-singing',
      20:'bawk-carol',
      22:'santa-says',
    };

    // Expose for inline CTA
    window.__LATW_PLACEMENT = PLACEMENT;
    window.__LATW_BONUS_COPY = BONUS_COPY;

    function qs(sel, root=document){ return root.querySelector(sel); }

    function ensureModal() {
      const host = qs('#bonusVaultModal');
      if (!host) return;
      host.innerHTML = `
        <div class="latw-modal__content">
          <button class="latw-modal__close" type="button" aria-label="Close">√ó</button>
          <h2 id="vaultTitle" class="latw-vault-title">Bonus Vault</h2>
          <ul class="latw-vault-list" role="list">
            ${Object.entries(BONUS_COPY).map(([id, b]) => `
              <li><button class="latw-vault-item" type="button" data-bonus-id="${id}">${b.title}</button></li>
            `).join('')}
          </ul>
          <div id="latw-bonus-detail" class="latw-bonus-detail" aria-live="polite"></div>
        </div>
      `;
    }

function openModal() {
  // close the tile/card behind the modal
  window.__closeViewer?.();

  const m = qs('#bonusVaultModal'); if (!m) return;
  m.classList.add('open');
  m.setAttribute('aria-hidden', 'false');
  document.body.style.overflow = 'hidden';

  // prevent card beneath from interacting
  const viewer = document.getElementById('viewer');
  if (viewer) viewer.setAttribute('inert','');
}

    function closeModal() {
      const m = qs('#bonusVaultModal'); if (!m) return;
      m.classList.remove('open');
      m.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
      const d = qs('#latw-bonus-detail'); if (d) d.innerHTML = '';
      const viewer = document.getElementById('viewer');
      if (viewer) viewer.removeAttribute('inert');
    }

    function renderBonus(id) {
      const b = BONUS_COPY[id]; if (!b) return;
      const d = qs('#latw-bonus-detail'); if (!d) return;
      d.innerHTML = `<h3>${b.title}</h3><p>${b.text}</p>`;
    }

    function injectStars(placement) {
      Object.entries(placement).forEach(([day, id]) => {
        const tile = document.querySelector(`.tile[data-day="${day}"]`);
        if (!tile || tile.querySelector('.latw-star')) return;

        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'latw-star';
        btn.setAttribute('aria-label', `Open bonus ${BONUS_COPY[id]?.title || 'Bonus'}`);
        btn.setAttribute('aria-pressed','false');
        btn.dataset.bonusId = id;
        btn.textContent = '‚≠ê';

        if (getComputedStyle(tile).position === 'static') {
          tile.style.position = 'relative';
        }
        tile.appendChild(btn);

        // Stop the tile click from firing
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation?.();
          renderBonus(btn.dataset.bonusId);
          openModal();
        });
        ['pointerdown','touchstart','mousedown'].forEach(evt => {
          btn.addEventListener(evt, (e) => {
            e.preventDefault();
            e.stopPropagation();
          }, {capture: true});
        });
      });
    }

    function wireEvents() {
      document.addEventListener('click', (e) => {
        const star = e.target.closest('.latw-star');
        if (star) {
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation?.();
          renderBonus(star.dataset.bonusId);
          openModal();
          return;
        }
        if (e.target.id === 'bonusVaultBtn') { openModal(); return; }
        if (e.target.classList.contains('latw-modal__close')) { closeModal(); return; }
        if (e.target.classList.contains('latw-vault-item')) { renderBonus(e.target.dataset.bonusId); return; }
        if (e.target.classList.contains('latw-star-inline')) {
          renderBonus(e.target.dataset.bonusId);
          openModal();
          return;
        }
        if (e.target.id === 'bonusVaultModal' && e.target.classList.contains('latw-modal')) { closeModal(); return; }
      });

      document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });
    }

    function initBonus() {
      ensureModal();
      injectStars(PLACEMENT);
      wireEvents();
    }

    // Run after DOM is ready and when Start reveals the grid
    window.__initLATWBonus = () => { try { initBonus(); } catch(e){} };
  })();
  </script>

  <!-- Service worker registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          const reg = await navigator.serviceWorker.register('./sw.js?v=2025-11-06-1');
          if (reg.waiting) reg.waiting.postMessage({ type: 'SKIP_WAITING' });
          navigator.serviceWorker.addEventListener('controllerchange', () => {
            if (!window.__swReloaded) {
              window.__swReloaded = true;
              location.reload();
            }
          });
        } catch {}
      });
    }
  </script>

</body>
</html>

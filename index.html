<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Laughing All the Way</title>

  <meta name="theme-color" content="#d93823" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="icon-192.png" sizes="192x192" />

  <!-- iOS Add to Home Screen support -->
  <link rel="apple-touch-icon" href="icon-192.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />

  <!-- Rounded, bubbly font for numbers & headings -->
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #d93823;       /* red background */
      --ink: #1f2a35;      /* body text */
      --card: #ffffff;     /* tiles and cards */
      --shadow: rgba(0,0,0,0.15);
      --line: #e5ecf0;
      --teal: #237e6b;     /* brand teal for numbers and accents */
      --ribbon: #d93823;   /* ribbon color on presents (red) */
      --ribbon2: #699eb0;  /* optional accent ribbon (teal) */
      --footer-h: 96px;    /* keep in sync with footer height/padding */
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color: var(--ink);
      padding-bottom: var(--footer-h); /* ensures content isn’t hidden behind fixed footer */
    }

    /* Wrap the visible app so we can blur it behind the welcome screen */
    #appWrap.blur {
      filter: blur(4px) saturate(0.9);
      pointer-events: none;
      user-select: none;
    }

    header { padding: 14px 16px 4px; text-align: center; }
    .brand {
      width: 320px; max-width: 78vw; height: auto;
      display: inline-block; border-radius: 18px;
      box-shadow: 0 6px 18px var(--shadow);
      background: transparent;
    }

    .controls { display: flex; gap: 10px; justify-content: center; margin: 8px 0; }
    .pill {
      background: var(--card); border: 1px solid var(--line);
      padding: 8px 12px; border-radius: 999px;
      box-shadow: 0 2px 6px var(--shadow);
      font-size: .9rem; cursor: pointer;
    }
    #installBtn { display: inline-block; }

    /* helper banner */
    #installHelp { display:none; margin:8px auto 0; max-width:820px; }
    #installHelp > div {
      background:#fff; border:1px solid var(--line); border-radius:12px;
      padding:10px 12px; box-shadow:0 2px 6px rgba(0,0,0,.08);
      font-size:.92rem; line-height:1.3; text-align:center;
    }

    .grid {
      display: grid; grid-template-columns: repeat(5, 1fr);
      gap: 12px; padding: 16px; max-width: 820px; margin: 10px auto 0;
    }

    /* Present-style tiles */
    .tile {
      aspect-ratio: 1 / 1;
      background: var(--card);
      color: var(--teal);       /* big number color */
      border-radius: 22px;
      display: flex; align-items: center; justify-content: center;
      font-family: 'Baloo 2', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      font-weight: 700;
      font-size: 2.3rem;        /* big, bubbly */
      box-shadow: 0 3px 10px var(--shadow);
      border: 1px solid var(--line);
      cursor: pointer;
      position: relative;
      user-select: none;
      transition: transform 0.1s ease, box-shadow 0.1s ease;
      overflow: hidden;
    }
    .tile:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 14px var(--shadow);
    }
    .tile.opened { outline: 3px solid rgba(35,126,107,0.4); }

    /* Ribbons (pure CSS) */
    .tile::before, .tile::after {
      content: "";
      position: absolute;
      background: linear-gradient(180deg, var(--ribbon), #b22c1b);
      opacity: 0.95;
    }
    .tile::before { /* vertical ribbon */
      width: 18%;
      height: 100%;
      left: 41%;
      top: 0;
    }
    .tile::after {  /* horizontal ribbon */
      height: 18%;
      width: 100%;
      top: 41%;
      left: 0;
    }

    /* Bow (pure CSS) */
    .bow {
      position: absolute;
      top: 12%;
      left: 50%;
      transform: translateX(-50%);
      width: 32px;
      height: 18px;
    }
    .bow::before, .bow::after {
      content: "";
      position: absolute;
      width: 22px; height: 18px;
      background: var(--ribbon);
      border-radius: 50% 50% 30% 30%;
      top: 0;
    }
    .bow::before { left: -22px; transform: rotate(-12deg); }
    .bow::after  { right: -22px; transform: rotate(12deg); }
    .knot {
      position: absolute; top: 2px; left: 50%; transform: translateX(-50%);
      width: 12px; height: 12px; background: #a72616; border-radius: 50%;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.4);
    }

    /* Fullscreen viewer */
    .viewer {
      position: fixed; inset: 0; background: rgba(0,0,0,.35);
      display: none; align-items: center; justify-content: center; padding: 16px;
      z-index: 3;
    }
    .viewer.open { display: flex; }

    .card {
      width: min(760px, 92vw);
      max-height: 86vh;
      overflow: auto;
      background: var(--card);
      border-radius: 26px;
      box-shadow: 0 8px 30px rgba(0,0,0,.25);
      border: 2px solid rgba(35,126,107,0.15);
      padding: 22px 22px 26px;
      transform: translateY(8px);
      animation: pop .18s ease-out both;
    }
    @keyframes pop { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }

    .card h2 {
      margin: 0 0 8px;
      font-size: 1.35rem;
      letter-spacing: .3px;
      color: var(--teal);
      font-family: 'Baloo 2', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      font-weight: 700;
    }
    .prompt {
      font-size: 1.05rem;
      line-height: 1.5;
      color: var(--ink);
      font-family: 'Baloo 2', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    .prompt em {
      color: var(--teal);
      font-style: normal;
      font-weight: 600;
    }

    .close {
      position: sticky; top: -8px; float: right;
      background: #f1f5f9; border: 0; border-radius: 10px; padding: 8px 10px; cursor: pointer;
      font-weight: 700; color: #2b4a5e; box-shadow: 0 2px 6px var(--shadow);
    }

    /* Snow canvas */
   /* Snow canvas (behind everything except background) */
#snow {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;
}

/* The entire app content sits above the snow */
#appWrap,
header,
main,
footer {
  position: relative;
  z-index: 2;
}

/* The brand graphic always sits at the very top front */
.brand {
  position: relative;
  z-index: 3;
}

    /* Fixed footer */
    footer {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: rgba(255,255,255,.92); backdrop-filter: blur(6px);
      border-top: 1px solid var(--line); padding: 12px 14px 18px;
      text-align: center; font-size: .78rem; line-height: 1.25rem;
      z-index: 2;
      min-height: calc(var(--footer-h) - 24px);
    }

    /* Responsive grid */
    @media (max-width: 620px) {
      .grid { grid-template-columns: repeat(4, 1fr); }
    }
  </style>
</head>
<body>
  <canvas id="snow"></canvas>

  <!-- Welcome / Agreement overlay -->
  <div id="welcome" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:5;">
    <div style="background:rgba(0,0,0,.45);position:absolute;inset:0;"></div>
    <div style="position:relative;background:#fff;border:1px solid #e5ecf0;border-radius:20px;box-shadow:0 12px 40px rgba(0,0,0,.35);padding:22px;max-width:580px;margin:20px;">
      <h2 style="margin:0 0 8px;font-family:'Baloo 2',system-ui;font-size:1.25rem;color:#237e6b;">
        Before you enter
      </h2>
      <p style="margin:6px 0 14px;font-size:.98rem;line-height:1.45;">
        This app is only for those who purchased from Playful Heart Parenting. Thank you for supporting this work.
      </p>
      <label style="display:flex;align-items:center;gap:10px;margin:2px 0 14px;font-size:.95rem;">
        <input id="agreeChk" type="checkbox" />
        <span>I agree to keep this link private and not share it publicly.</span>
      </label>
      <button id="agreeBtn" disabled
        style="background:#237e6b;color:#fff;border:0;border-radius:999px;padding:10px 14px;font-weight:700;cursor:not-allowed;box-shadow:0 2px 6px rgba(0,0,0,.15);">
        Enter
      </button>
    </div>
  </div>

  <div id="appWrap" class="blur">
    <header>
      <img class="brand" src="./LATWlogo.png" alt="Laughing All the Way — Advent Calendar from Playful Heart Parenting" />
      <div class="controls">
        <button class="pill" id="installBtn" hidden>Install</button>
      </div>
      <div id="installHelp"><div><span id="installHelpText"></span></div></div>
    </header>

    <main>
      <section class="grid" id="grid"></section>
    </main>
  </div>

  <footer>
    © 2025 Mia Wisinski, Playful Heart Parenting. This app is for personal use only by those who have purchased access from Playful Heart Parenting. Please do not share this link publicly or distribute without explicit permission.
  </footer>

  <!-- Fullscreen Viewer -->
  <div class="viewer" id="viewer" aria-modal="true" role="dialog">
    <div class="card" id="card">
      <button class="close" id="closeBtn">Close</button>
      <h2 id="cardTitle"></h2>
      <div class="prompt" id="cardBody"></div>
    </div>
  </div>

  <script>
  // ---- Content ----
  const IDEAS = [
    "Day 1 — Serious Santa: Put on your most serious face and try not to laugh while saying ‘Ho! Ho! Ho!’ <em>For littler elves: big ‘Ho! Ho! Ho!’s and funny faces.</em>",
    "Day 2 — Reverse Christmas Charades: Give step-by-step instructions to make someone act it out, then guess. <em>For littler elves: do simple charades with sounds.</em>",
    "Day 3 — Very Merry Ventriloquism: Say holiday phrases without moving your lips. <em>For littler elves: use a puppet or stuffed animal voice.</em>",
    "Day 4 — Dashing Through the Doodles: Finger-draw a holiday picture to guess. <em>For littler elves: offer two choices or draw on paper.</em>",
    "Day 5 — Jingle Jargon: Speak in elf gibberish and translate. <em>For littler elves: try short silly giggles and gibberish.</em>",
    "Day 6 — Holly Jolly Handshake: Invent a handshake with 2–3 moves. <em>For littler elves: keep moves easy with sound effects.</em>",
    "Day 7 — Hot Stocking: Hot-potato with balled socks. Loser does a silly challenge. <em>For littler elves: pass a plush slowly. Skip the challenge if needed.</em>",
    "Day 8 — Tinsel Twisters: Try “Santa’s short suit shrunk,” etc. five times fast. <em>For littler elves: go slowly and enjoy the sounds.</em>",
    "Day 9 — Winter Would You Rather: Ask holiday would-you-rather questions. <em>For littler elves: use very simple either-or.</em>",
    "Day 10 — Merry Mad Libs: Fill in the blanks for a goofy story. <em>For littler elves: you suggest easy words like color or snack.</em>",
    "Day 11 — Strike a Jolly Pose: Lights off. Pose on a prompt. Lights on. Pick the funniest. <em>For littler elves: skip lights. Just pose together.</em>",
    "Day 12 — Kooky Carols: Sing alternating words. Try syllables if brave. <em>For littler elves: sing together. Let them lead a word.</em>",
    "Day 13 — Christmas Choreographer: Make moves. Others copy. Build a family dance. <em>For littler elves: copy their moves or let them teach.</em>",
    "Day 14 — Hot Cocoa Freeze Challenge: Pretend to sip then freeze your face. <em>For littler elves: you freeze and make them giggle.</em>",
    "Day 15 — Truth or Merry Mischief: Answer a truth or do a harmless dare. <em>For littler elves: tiny truths. Dares like clap or spin.</em>",
    "Day 16 — Silent Night Singing: Lip-sync a carol while others guess. <em>For littler elves: hum or tap the rhythm.</em>",
    "Day 17 — Santa Says: Simon Says with Santa. Keep everyone playing. <em>For littler elves: no out. Just play.</em>",
    "Day 18 — Ice Powers: Kids shout Freeze then Unfreeze and run to base. <em>For littler elves: try freeze dance first.</em>",
    "Day 19 — Impromptu Nutcracker: Dance to The Nutcracker and capture it. <em>For littler elves: hold hands and spin.</em>",
    "Day 20 — Holiday Mind Meld: 1 2 3 say the same holiday word together. <em>For littler elves: be a mirror. Match faces and sounds.</em>",
    "Day 21 — 10 Second Shenanigans: Act a quick holiday scenario in ten seconds. <em>For littler elves: you perform. They pick or join.</em>",
    "Day 22 — The Jolly Storyteller: Build a story sentence by sentence. <em>For littler elves: pause and point for a key word.</em>",
    "Day 23 — Reindeer Hop Challenge: Hop like a reindeer for one minute. <em>For littler elves: jump or stomp or clap.</em>",
    "Day 24 — Jingle Jangle Jam: Make up a song at the same time. <em>For littler elves: simple tune with silly wrong words.</em>",
    "Day 25 — That’s a Wrap: Wrap feet or a blanket present. Over react as you unwrap. <em>For littler elves: wrap a blanket gift. Celebrate them.</em>"
  ];

  // ---- Build present tiles ----
  const grid = document.getElementById('grid');
  function makeTile(i){
    const day = i + 1;
    const el = document.createElement('button');
    el.className = 'tile';
    el.type = 'button';
    el.innerHTML = `<span class="bow"></span><span class="knot"></span>${day}`;
    el.addEventListener('click', () => openViewer(day, IDEAS[i]));
    return el;
  }
  function renderGrid(){ grid.innerHTML = ''; for (let i=0;i<25;i++) grid.appendChild(makeTile(i)); }
  renderGrid();

  // ---- Fullscreen viewer ----
  const viewer = document.getElementById('viewer');
  const cardTitle = document.getElementById('cardTitle');
  const cardBody  = document.getElementById('cardBody');
  const closeBtn  = document.getElementById('closeBtn');

  function openViewer(day, html){
    cardTitle.textContent = `Day ${day}`;
    cardBody.innerHTML = html;
    viewer.classList.add('open');
  }
  function closeViewer(){
    viewer.classList.remove('open');
    if (location.search.includes('day=')) history.replaceState(null,'', location.pathname);
  }
  viewer.addEventListener('click', (e) => { if (e.target === viewer) closeViewer(); });
  closeBtn.addEventListener('click', closeViewer);
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeViewer(); });

  // ---- Welcome / Agreement (one-time) ----
  const ACK_KEY = 'latw_ack_v1';
  const appWrap = document.getElementById('appWrap');
  const welcome = document.getElementById('welcome');
  const agreeChk = document.getElementById('agreeChk');
  const agreeBtn = document.getElementById('agreeBtn');

  function showWelcome(){
    appWrap.classList.add('blur');
    welcome.style.display = 'flex';
    document.body.style.overflow = 'hidden';
  }
  function hideWelcome(){
    appWrap.classList.remove('blur');
    welcome.style.display = 'none';
    document.body.style.overflow = '';
  }
  if (!localStorage.getItem(ACK_KEY)) showWelcome();
  agreeChk.addEventListener('change', () => {
    agreeBtn.disabled = !agreeChk.checked;
    agreeBtn.style.cursor = agreeChk.checked ? 'pointer' : 'not-allowed';
    agreeBtn.style.opacity = agreeChk.checked ? '1' : '.8';
  });
  agreeBtn.addEventListener('click', () => {
    if (!agreeChk.checked) return;
    localStorage.setItem(ACK_KEY, 'yes');
    hideWelcome();
  });

  // ---- Snowfall (white flakes on red) ----
  const canvas = document.getElementById('snow');
  const ctx = canvas.getContext('2d');
  function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
  addEventListener('resize', resize); resize();
  const flakes = Array.from({length: Math.min(200, Math.floor(innerWidth/5))},
    () => ({ x: Math.random()*innerWidth, y: Math.random()*innerHeight, r: Math.random()*2+0.7, s: Math.random()*0.7+0.2 })
  );
  (function snow(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = 'rgba(255,255,255,0.95)';
    for (const f of flakes){
      ctx.beginPath(); ctx.arc(f.x, f.y, f.r, 0, Math.PI*2); ctx.fill();
      f.y += f.s; f.x += Math.sin(f.y*0.01);
      if (f.y > canvas.height) { f.y = -6; f.x = Math.random()*canvas.width; }
    }
    requestAnimationFrame(snow);
  })();

  // ---- Install UI + helper banner (never show Install on iPhone/Safari) ----
  const isStandalone =
    window.matchMedia('(display-mode: standalone)').matches ||
    window.navigator.standalone === true;
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
  const isSafari = /^((?!chrome|android|crios|fxios|edgios).)*safari/i.test(navigator.userAgent);
  const isAndroid = /Android/i.test(navigator.userAgent);

  const helpWrap = document.getElementById('installHelp');
  const helpText = document.getElementById('installHelpText');
  const installBtn = document.getElementById('installBtn');

  // Hide install UI if already installed or on iOS Safari
  if (isStandalone || (isIOS && isSafari)) {
    if (installBtn) installBtn.hidden = true;
    if (helpWrap) helpWrap.style.display = 'none';
  }

  let deferredPrompt;
  window.addEventListener('beforeinstallprompt', (e) => {
    // iOS never fires this; Chrome/Edge do. Only show button when supported.
    e.preventDefault();
    deferredPrompt = e;
    if (!isStandalone && !(isIOS && isSafari) && installBtn) installBtn.hidden = false;
    if (helpWrap) helpWrap.style.display = 'none';
  });

  if (installBtn) {
    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      installBtn.hidden = true;
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null;
    });
  }

  window.addEventListener('load', () => {
    if (isStandalone) return;
    const noPromptSupport = !('onbeforeinstallprompt' in window);
    if (noPromptSupport) {
      if (isIOS && isSafari) {
        helpText.textContent = 'To install on iPhone. Tap Share, then Add to Home Screen.';
        helpWrap.style.display = 'block';
      } else if (isAndroid) {
        helpText.textContent = 'To install on Android. Open in Chrome to see the Install button or menu Add to Home screen.';
        helpWrap.style.display = 'block';
      } else {
        helpText.textContent = 'To install. Use Chrome or Edge Install. On iPhone use Share then Add to Home Screen.';
        helpWrap.style.display = 'block';
      }
    }
  });

  // ---- Service Worker ----
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
  }
  </script>
</body>
</html>

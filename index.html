<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Laughing All the Way</title>

  <meta name="theme-color" content="#d93823" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="icon-192.png" sizes="192x192" />

  <!-- iOS Add to Home Screen support -->
  <link rel="apple-touch-icon" href="icon-192.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />

  <!-- Rounded, bubbly font -->
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#d93823;
      --ink:#1f2a35;
      --card:#ffffff;
      --shadow:rgba(0,0,0,0.15);
      --line:#e5ecf0;
      --teal:#237e6b;
    }

    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      display:flex;
      flex-direction:column;
      min-height:100vh;
    }
    #appWrap{flex:1}
    #appWrap.blur{filter:blur(4px) saturate(.9);pointer-events:none;user-select:none}

    header{text-align:center;padding:14px 16px 4px;}
    .brand{
      width:320px;max-width:78vw;height:auto;
      display:inline-block;border-radius:18px;
      box-shadow:0 6px 18px var(--shadow);
      background:transparent;
      position:relative;z-index:3;
    }

    .controls{display:flex;gap:10px;justify-content:center;margin:8px 0}
    .pill{
      background:var(--card);border:1px solid var(--line);
      padding:8px 12px;border-radius:999px;
      box-shadow:0 2px 6px var(--shadow);
      font-size:.9rem;cursor:pointer;
    }
    #installBtn{display:none}

    #installHelp{display:none;margin:8px auto 0;max-width:820px;text-align:center;}
    #installHelp>div{
      background:#fff;border:1px solid var(--line);border-radius:12px;
      padding:10px 12px;box-shadow:0 2px 6px rgba(0,0,0,.08);
      font-size:.92rem;line-height:1.3;
      font-family:'Baloo 2',system-ui;
    }
    #closeInstallHelp{
      margin-top:6px;
      background:#237e6b;
      color:#fff;
      border:0;
      border-radius:999px;
      padding:6px 14px;
      font-family:'Baloo 2',system-ui;
      font-weight:700;
      font-size:.85rem;
      cursor:pointer;
      box-shadow:0 2px 6px rgba(0,0,0,.15);
      transition:transform .1s ease, box-shadow .1s ease;
    }
    #closeInstallHelp:hover{
      transform:translateY(-1px);
      box-shadow:0 3px 10px rgba(0,0,0,.25);
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(5,1fr);
      gap:12px;
      padding:16px;
      max-width:820px;
      margin:10px auto 20px;
      position:relative;
      z-index:2;
    }

    /* Gift-box style tiles */
    .tile{
      aspect-ratio:1/1;
      background:var(--card);
      color:var(--teal);
      border-radius:22px;
      border:4px solid var(--teal);
      display:flex;align-items:center;justify-content:center;
      font-family:'Baloo 2',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      font-weight:700;font-size:2.3rem;
      box-shadow:0 3px 10px var(--shadow);
      cursor:pointer;position:relative;user-select:none;
      transition:transform .1s ease, box-shadow .1s ease;
      overflow:hidden;
    }
    .tile:hover{transform:translateY(-2px);box-shadow:0 5px 14px var(--shadow)}
    .tile.opened{outline:3px solid rgba(35,126,107,.35)}
    .tile::before{
      content:"";
      position:absolute;
      top:0;left:0;right:0;
      height:20%;
      border-bottom:4px solid var(--teal);
      border-top-left-radius:18px;
      border-top-right-radius:18px;
    }

    /* Viewer */
    .viewer{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;padding:16px;z-index:3}
    .viewer.open{display:flex}
    .card{
      width:min(760px,92vw);
      max-height:86vh;
      overflow:auto;
      background:var(--card);
      border-radius:26px;
      box-shadow:0 8px 30px rgba(0,0,0,.25);
      border:2px solid rgba(35,126,107,.15);
      padding:22px 22px 26px;
      transform:translateY(8px);
      animation:pop .18s ease-out both;
    }
    @keyframes pop{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
    .card h2{margin:0 0 8px;font-size:1.35rem;letter-spacing:.3px;color:var(--teal);font-family:'Baloo 2',system-ui;font-weight:700}
    .prompt{font-size:1.05rem;line-height:1.5;color:var(--ink);font-family:'Baloo 2',system-ui;}
    .prompt em{color:var(--teal);font-style:normal;font-weight:600}
    .close{position:sticky;top:-8px;float:right;background:#f1f5f9;border:0;border-radius:10px;padding:8px 10px;cursor:pointer;font-weight:700;color:#2b4a5e;box-shadow:0 2px 6px var(--shadow)}

    /* Snow behind everything */
    #snow{position:fixed;inset:0;pointer-events:none;z-index:0}
    header,main,footer,#appWrap{position:relative;z-index:2}

    footer{
      background:rgba(255,255,255,.92);
      border-top:1px solid var(--line);
      padding:12px 14px 18px;
      text-align:center;
      font-size:.78rem;
      line-height:1.25rem;
    }

    @media (max-width:620px){.grid{grid-template-columns:repeat(4,1fr)}}
  </style>
</head>
<body>
  <canvas id="snow"></canvas>

  <!-- Welcome / Agreement overlay -->
  <div id="welcome" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:5;">
    <div style="background:rgba(0,0,0,.45);position:absolute;inset:0;"></div>
    <div style="position:relative;background:#fff;border:1px solid #e5ecf0;border-radius:20px;box-shadow:0 12px 40px rgba(0,0,0,.35);padding:22px;max-width:580px;margin:20px;">
      <h2 style="margin:0 0 8px;font-family:'Baloo 2',system-ui;font-size:1.25rem;color:#237e6b;">Before you enter</h2>
      <p style="margin:6px 0 14px;font-size:.98rem;line-height:1.45;">
        This app is only for those who purchased from Playful Heart Parenting. Thank you for supporting this work!
      </p>
      <label style="display:flex;align-items:center;gap:10px;margin:2px 0 14px;font-size:.95rem;">
        <input id="agreeChk" type="checkbox" />
        <span>I agree to keep this link private and not share it.</span>
      </label>
      <button id="agreeBtn" disabled
        style="background:#237e6b;color:#fff;border:0;border-radius:999px;padding:10px 14px;font-weight:700;cursor:not-allowed;box-shadow:0 2px 6px rgba(0,0,0,.15);font-family:'Baloo 2',system-ui;">
        Enter
      </button>
    </div>
  </div>

  <div id="appWrap" class="blur">
    <header>
      <img class="brand" src="./LATWlogo.png" alt="Laughing All the Way — Advent Calendar from Playful Heart Parenting" />
      <div class="controls">
        <button class="pill" id="installBtn">Install</button>
      </div>

      <div id="installHelp">
        <div>
          <span id="installHelpText"></span>
          <br />
          <button id="closeInstallHelp">Close</button>
        </div>
      </div>
    </header>

    <main>
      <section class="grid" id="grid"></section>
    </main>
  </div>

  <footer>
    © 2025 Mia Wisinski, Playful Heart Parenting. This app is for personal use only by those who have purchased access from Playful Heart Parenting. Please do not share this link publicly or distribute without explicit permission.
  </footer>

  <!-- Fullscreen Viewer -->
  <div class="viewer" id="viewer" aria-modal="true" role="dialog">
    <div class="card" id="card">
      <button class="close" id="closeBtn">Close</button>
      <h2 id="cardTitle"></h2>
      <div class="prompt" id="cardBody"></div>
    </div>
  </div>

  <script>
  // ---- Content ----
  const IDEAS = Array.from({length:25},(_,i)=>`Day ${i+1} — Placeholder content here.`);

  const grid=document.getElementById('grid');
  function makeTile(i){
    const day=i+1;
    const el=document.createElement('button');
    el.className='tile';
    el.type='button';
    el.textContent=day;
    el.addEventListener('click',()=>openViewer(day,IDEAS[i]));
    return el;
  }
  function renderGrid(){grid.innerHTML='';for(let i=0;i<25;i++)grid.appendChild(makeTile(i));}
  renderGrid();

  const viewer=document.getElementById('viewer');
  const cardTitle=document.getElementById('cardTitle');
  const cardBody=document.getElementById('cardBody');
  const closeBtn=document.getElementById('closeBtn');
  function openViewer(day,html){cardTitle.textContent=`Day ${day}`;cardBody.innerHTML=html;viewer.classList.add('open');}
  function closeViewer(){viewer.classList.remove('open');}
  viewer.addEventListener('click',e=>{if(e.target===viewer)closeViewer();});
  closeBtn.addEventListener('click',closeViewer);
  document.addEventListener('keydown',e=>{if(e.key==='Escape')closeViewer();});

  // ---- Welcome / Agreement ----
  const ACK_KEY='latw_ack_v1';
  const appWrap=document.getElementById('appWrap');
  const welcome=document.getElementById('welcome');
  const agreeChk=document.getElementById('agreeChk');
  const agreeBtn=document.getElementById('agreeBtn');
  function showWelcome(){appWrap.classList.add('blur');welcome.style.display='flex';document.body.style.overflow='hidden';}
  function hideWelcome(){appWrap.classList.remove('blur');welcome.style.display='none';document.body.style.overflow='';}
  if(!localStorage.getItem(ACK_KEY))showWelcome();
  agreeChk.addEventListener('change',()=>{agreeBtn.disabled=!agreeChk.checked;agreeBtn.style.cursor=agreeChk.checked?'pointer':'not-allowed';});
  agreeBtn.addEventListener('click',()=>{if(!agreeChk.checked)return;localStorage.setItem(ACK_KEY,'yes');hideWelcome();});

  // ---- Snowfall ----
  const canvas=document.getElementById('snow'),ctx=canvas.getContext('2d');
  function resize(){canvas.width=innerWidth;canvas.height=innerHeight;}
  addEventListener('resize',resize);resize();
  const flakes=Array.from({length:Math.min(200,Math.floor(innerWidth/5))},()=>({x:Math.random()*innerWidth,y:Math.random()*innerHeight,r:Math.random()*2+0.7,s:Math.random()*0.7+0.2}));
  (function snow(){ctx.clearRect(0,0,canvas.width,canvas.height);ctx.fillStyle='rgba(255,255,255,0.95)';for(const f of flakes){ctx.beginPath();ctx.arc(f.x,f.y,f.r,0,Math.PI*2);ctx.fill();f.y+=f.s;f.x+=Math.sin(f.y*0.01);if(f.y>canvas.height){f.y=-6;f.x=Math.random()*canvas.width;}}requestAnimationFrame(snow);})();

  // ---- Install UI ----
  const isStandalone=window.matchMedia('(display-mode: standalone)').matches||window.navigator.standalone===true;
  const isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent)||('ontouchend'in document&&navigator.userAgent.includes('Mac'));
  const isSafari=/^((?!chrome|android|crios|fxios|edgios).)*safari/i.test(navigator.userAgent);
  const isAndroid=/Android/i.test(navigator.userAgent);

  const helpWrap=document.getElementById('installHelp');
  const helpText=document.getElementById('installHelpText');
  const closeInstallHelp=document.getElementById('closeInstallHelp');
  const installBtn=document.getElementById('installBtn');
  const CLOSE_KEY='latw_installHelp_closed';

  if(localStorage.getItem(CLOSE_KEY)){helpWrap.style.display='none';}

  if(isIOS){installBtn.remove();}

  let deferredPrompt;
  window.addEventListener('beforeinstallprompt', e=>{
    e.preventDefault();
    deferredPrompt=e;
    if(!isStandalone && !isIOS){installBtn.style.display='inline-block';}
    if(helpWrap)helpWrap.style.display='none';
  });

  if(installBtn){
    installBtn.addEventListener('click',async()=>{
      if(!deferredPrompt)return;
      installBtn.style.display='none';
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt=null;
    });
  }

  window.addEventListener('load',()=>{
    if(isStandalone)return;
    const noPromptSupport=!('onbeforeinstallprompt'in window);
    if(noPromptSupport){
      if(isIOS){
        helpText.textContent='To install on iPhone: tap Share → Add to Home Screen.';
        helpWrap.style.display=localStorage.getItem(CLOSE_KEY)?'none':'block';
      }else if(isAndroid){
        helpText.textContent='To install on Android: open in Chrome → menu → Add to Home screen.';
        helpWrap.style.display=localStorage.getItem(CLOSE_KEY)?'none':'block';
      }else{
        helpText.textContent='To install: use Chrome or Edge Install button, or on iPhone use Share → Add to Home Screen.';
        helpWrap.style.display=localStorage.getItem(CLOSE_KEY)?'none':'block';
      }
    }
  });

  if(closeInstallHelp){
    closeInstallHelp.addEventListener('click',()=>{
      helpWrap.style.display='none';
      localStorage.setItem(CLOSE_KEY,'true');
    });
  }

  // ---- Service Worker ----
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', async () => {
      try {
        const reg = await navigator.serviceWorker.register('./sw.js?ver=safe1');
        if (reg.waiting) reg.waiting.postMessage('SKIP_WAITING');
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          if (!window.__swReloaded) {
            window.__swReloaded = true;
            location.reload();
          }
        });
      } catch {}
    });
  }
</script>

</body>
</html>

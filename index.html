<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Laughing All the Way</title>

  <!-- PWA basics -->
  <meta name="theme-color" content="#d93823" />
  <link rel="manifest" href="manifest.webmanifest" />

  <!-- Icons in repo root (not in /icons) -->
  <link rel="icon" href="icon-192.png" sizes="192x192" />
  <link rel="apple-touch-icon" href="icon-192.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">


  <style>
    :root{
      --bg:#d93823;
      --ink:#1f2a35;
      --card:#ffffff;
      --shadow:rgba(0,0,0,0.15);
      --line:#e5ecf0;
      --teal:#237e6b;
    }

    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      display:flex; flex-direction:column; min-height:100vh;
    }

    /* App wrapper + blur when gated */
    #appWrap{flex:1}
    #appWrap.blur{filter:blur(4px) saturate(.9); pointer-events:none; user-select:none}
    

    /* Header */
    header{text-align:center; padding:14px 16px 4px;}
    .brand{
      width:320px; max-width:78vw; height:auto;
      display:inline-block; border-radius:18px;
      box-shadow:0 6px 18px var(--shadow);
      background:transparent; position:relative; z-index:3;
    }

    .controls{display:flex; gap:10px; justify-content:center; margin:8px 0}
    .pill{
      background:var(--card); border:1px solid var(--line);
      padding:8px 12px; border-radius:999px;
      box-shadow:0 2px 6px var(--shadow);
      font-size:.9rem; cursor:pointer;
    }
    #installBtn{display:none}

    /* Install-help bar (from WYR template) */
    .install-help {position:sticky; top:0; z-index:10001; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .install-help__wrap{background:#fff7f4; border-bottom:1px solid #f2e7e3}
    .install-help__summary{display:flex; align-items:center; gap:.5rem; padding:.55rem .85rem; cursor:pointer; font-size:.95rem}
    .install-help__summary:hover{background:#fff3ee}
    summary.install-help__wrap::-webkit-details-marker{display:none}
    summary.install-help__wrap::marker{content:''; font-size:0}
    .install-help__summary .caret{transition:transform .2s ease; width:40px; height:40px}
    details[open] .install-help__summary .caret{transform:rotate(180deg)}
    details[open] .install-help__wrap{box-shadow:inset 0 -1px 0 #e7d8d3, 0 1px 0 #e7d8d3}
    .install-help__panel{padding:.75rem .9rem .95rem .9rem; display:grid; gap:.75rem; background:#fff}
    .install-help__panel h4{margin:.25rem 0 .25rem 0; font-size:.95rem}
    .install-help__panel p{margin:0 0 .35rem 0; font-size:.9rem}
    .install-help__close{all:unset; display:inline-grid; place-items:center; width:32px; height:32px; cursor:pointer; color:#000; line-height:1; font-weight:700}
    .install-help__tips{font-size:.85rem; opacity:.9}
    .install-help__box{border:1px solid #efdfda; background:#fff; border-radius:.65rem; padding:.65rem .75rem}
    .install-help__steps{margin:.25rem 0 0 1.15rem}
    .install-help__steps li{margin:.25rem 0}
    .install-help__never{align-self:start; border:0; background:transparent; padding:0; font:inherit; color:#6b7f88; text-decoration:underline; cursor:pointer}
    .hidden{display:none}
    .install-help.gate-hide{display:none}
    @media (prefers-reduced-motion: reduce){.install-help__summary .caret{transition:none}}

    /* Grid */
    .grid{
      display:grid; grid-template-columns:repeat(5,1fr);
      gap:12px; padding:16px; max-width:820px; margin:10px auto 20px;
      position:relative; z-index:2;
    }
    .tile{
      aspect-ratio:1/1; background:#fff8d2; color:var(--teal);
      border-radius:22px; border:4px solid var(--teal);
      display:flex; align-items:center; justify-content:center;
      font-family:'Baloo 2',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      font-weight:700; font-size:2.3rem;
      box-shadow:0 3px 10px var(--shadow);
      cursor:pointer; position:relative; user-select:none;
      transition:transform .1s ease, box-shadow .1s ease; overflow:hidden;
    }
    .tile:hover{transform:translateY(-2px); box-shadow:0 5px 14px var(--shadow)}
    .tile.opened{outline:3px solid rgba(35,126,107,.35)}
    .tile::before{
      content:""; position:absolute; top:0; left:0; right:0; height:20%;
      border-bottom:4px solid var(--teal);
      border-top-left-radius:18px; border-top-right-radius:18px;
    }

    /* Viewer */
    .viewer{position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; align-items:center; justify-content:center; padding:16px; z-index:3}
    .viewer.open{display:flex}
    .card{
      width:min(760px,92vw); max-height:86vh; overflow:auto;
      background:var(--card); border-radius:26px;
      box-shadow:0 8px 30px rgba(0,0,0,.25);
      border:2px solid rgba(35,126,107,.15);
      padding:22px 22px 26px;
      transform:translateY(8px); animation:pop .18s ease-out both;
    }
    @keyframes pop{from{opacity:0; transform:translateY(12px)} to{opacity:1; transform:translateY(0)}}
    .card h2{margin:0 0 8px; font-size:1.35rem; letter-spacing:.3px; color:var(--teal); font-family:'Baloo 2',system-ui; font-weight:700}
    .prompt{font-size:1.05rem; line-height:1.5; color:var(--ink); font-family:'Baloo 2',system-ui;}
    .prompt em{color:var(--teal); font-style:normal; font-weight:600}
    .close{position:sticky; top:-8px; float:right; background:#f1f5f9; border:0; border-radius:10px; padding:8px 10px; cursor:pointer; font-weight:700; color:#2b4a5e; box-shadow:0 2px 6px var(--shadow)}

    /* Snow behind everything */
    #snow{position:fixed; inset:0; pointer-events:none; z-index:0}
    header,main,footer,#appWrap{position:relative; z-index:2}

    footer{
      background:rgba(255,255,255,.92);
      border-top:1px solid var(--line);
      padding:12px 14px 18px; text-align:center;
      font-size:.78rem; line-height:1.25rem;
    }

    @media (max-width:620px){.grid{grid-template-columns:repeat(4,1fr)}}
    /* Tile body text inside the opened card */
.prompt {
  font-family: "Poppins", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif !important;
  font-size: 1.05rem;
  line-height: 1.5;
  color: var(--ink);
}

.prompt em {
  color: var(--teal);
  font-style: normal;
  font-weight: 600;
}
/* Mad Libs: lightweight, touch-friendly form */
.madlib-form {
  display: grid;
  gap: .75rem;
  margin-top: .5rem;
}

.madlib-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: .6rem .8rem;
}
@media (max-width: 560px) {.madlib-grid{grid-template-columns: 1fr}}

.madlib-field {
  display: grid;
  gap: .25rem;
}

.madlib-field label {
  font-size: .9rem;
  color: var(--teal);
  font-weight: 600;
}

.madlib-field input {
  font: inherit;
  padding: .55rem .65rem;
  border: 1px solid var(--line);
  border-radius: .55rem;
  background: #fff;
}

.madlib-actions {
  display: flex;
  gap: .6rem;
  margin-top: .6rem;
}

.madlib-btn {
  all: unset;
  cursor: pointer;
  background: var(--teal);
  color: #fff;
  padding: .55rem .8rem;
  border-radius: .6rem;
  font-weight: 700;
  box-shadow: 0 2px 6px var(--shadow);
}

.madlib-btn.secondary {
  background: #eef3f5;
  color: #2b4a5e;
}

.madlib-output {
  white-space: pre-line;     /* shows line breaks */
  font-family: "Poppins", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  line-height: 1.55;
  margin-top: .75rem;
  font-size: 1.05rem;
}

  </style>
</head>
<body>
  <!-- Snow -->
  <canvas id="snow"></canvas>

  <!-- Install-help bar, hidden until privacy accepted -->
  <details class="install-help gate-hide" id="install-help" data-dismiss-key="latw-install-help">
    <summary class="install-help__wrap">
      <div class="install-help__summary" role="button" aria-expanded="false">
        <svg class="caret" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path d="M7 10l5 5 5-5z"></path></svg>
        <strong>Tap for a reminder on saving this app to your home screen</strong>
        <button class="install-help__close" type="button" title="Hide">✖</button>
      </div>
    </summary>
    <div class="install-help__panel" id="install-help-panel" aria-live="polite">
      <div class="install-help__box" id="ios-safari" hidden>
        <h4>iPhone or iPad using Safari</h4>
        <ol class="install-help__steps">
          <li>Tap the Share icon</li><li>Choose <em>Add to Home Screen</em></li><li>Tap <em>Add</em></li>
        </ol>
      </div>
      <div class="install-help__box" id="ios-chrome" hidden>
        <h4>iPhone or iPad using Chrome</h4>
        <ol class="install-help__steps">
          <li>Tap the Share icon</li><li>Select <em>Add to Home Screen</em></li><li>Tap <em>Add</em></li>
        </ol>
      </div>
      <div class="install-help__box" id="android-chrome" hidden>
        <h4>Android using Chrome</h4>
        <ol class="install-help__steps">
          <li>Tap the menu</li><li>Choose <em>Install app</em> or <em>Add to Home screen</em></li><li>Confirm</li>
        </ol>
      </div>
      <div class="install-help__box" id="android-samsung" hidden>
        <h4>Android using Samsung Internet</h4>
        <ol class="install-help__steps">
          <li>Tap the menu</li><li>Select <em>Add page to</em> → <em>Home screen</em></li><li>Confirm</li>
        </ol>
      </div>
      <div class="install-help__box" id="other-browsers" hidden>
        <h4>Other browsers</h4>
        <p>Look in the menu for <em>Install</em> or <em>Add to Home Screen</em></p>
      </div>
      <p class="install-help__tips">Installing adds an icon to your Home Screen and makes it behave like an app</p>
      <button type="button" id="install-help-never" class="install-help__never">Don’t show this again</button>
    </div>
  </details>

  <!-- Privacy / Courtesy overlay -->
  <section id="courtesyOverlay" role="dialog" aria-labelledby="courtesyTitle" aria-modal="true" style="position:fixed; inset:0; display:none; place-items:center; z-index:9999; background:rgba(0,0,0,.45);">
    <div class="courtesy-card" style="width:min(560px,92%); background:#fff; color:#3c3c3c; border-radius:18px; box-shadow:0 12px 40px rgba(0,0,0,.18); padding:22px; text-align:left;">
      <h2 id="courtesyTitle" style="margin:0 0 8px; color:#237e6b; font-family:'Baloo 2',system-ui; font-size:20px;">Thanks for supporting this work</h2>
      <p style="margin:6px 0 14px; color:#666;">This app is for customers of Playful Heart Parenting. Please keep this link private.</p>
      <label class="courtesy-check" style="display:flex; align-items:center; gap:10px; margin:6px 0 12px;">
        <input type="checkbox" id="courtesyAck" />
        <span>I understand</span>
      </label>
      <button id="courtesyContinue" disabled style="width:100%; padding:12px 14px; border:0; border-radius:14px; font-weight:700; cursor:not-allowed; background:#b24627; color:#fff;">
        Continue
      </button>
    </div>
  </section>

  <!-- App -->
  <div id="appWrap">
    <header>
      <img class="brand" src="./LATWlogo.png" alt="Laughing All the Way — Advent Calendar from Playful Heart Parenting" />
      <div class="controls">
        <button class="pill" id="installBtn">Install</button>
      </div>
    </header>

    <main>
      <section class="grid" id="grid"></section>
    </main>
  </div>

  <footer>
    © 2025 Mia Wisinski, Playful Heart Parenting. For personal use by purchasers only.
  </footer>

  <!-- Viewer -->
  <div class="viewer" id="viewer" aria-modal="true" role="dialog">
    <div class="card" id="card">
      <button class="close" id="closeBtn">Close</button>
      <h2 id="cardTitle"></h2>
      <div class="prompt" id="cardBody"></div>
    </div>
  </div>

  <!-- Main Script -->
  <script>
  /* ----------------- Content ----------------- */
const IDEAS = [
  // WEEK 1
  `Day 1 — Who Can Sound Like
• an elf who just burned their tongue a little bit on hot chocolate
• a baby polar bear trying to growl for the first time
• reindeer hoofs on the roof (and the reindeer are super excited because it’s the first house of the night!)`,

  `Day 2 — Make This Face
• You just looked up in the sky and saw Santa’s sleigh and he waved at you
• You’re just about to open a giant present but then the box starts wiggling and making strange noises…
• Something just poked you in the back and you turn around to see it was a reindeer’s antler and Rudolph is staring at you`,

  `Day 3 — You Are
• A baby penguin waddling across the slippery ice for the first time
• A tired but happy elf who just made 3,645 toys and is collapsing on the floor from exhaustion
• The star getting lifted up and put on top of the tree - so exicted to show off how bright it can shine`,

  `Day 4 — Would You Rather
• …wear jingle bells around your ankles all year long that jingle wherever you go OR hear the song “Jingle Bells” on repeat all year round
• …get around everywhere by riding in Santa’s sleigh OR by riding on a reindeer
• …have a magical mug of hot cocoa that refills itself whenever you snap OR a magical plate of sugar cookies that refills whenever you say “Cookies please!”`,

  `Day 5 — Plot Twist Story: The Very Shy Snowman
• Suddenly, a little girl ran by. She was carrying a giant box of cookies, but then she tripped and the cookies went flying… Where did they land
• Just then, a sweet little old lady walked up and said, “Pardon me, but I think this belongs to you!” She was holding a sparkly, golden ornament with words painted on it that said…
• Then a voice started singing “We Wish You A Merry Christmas.” It was the most beautiful singing anyone had ever heard. It was getting louder and louder, until they realized where it was coming from. Who was it`,

  // WEEK 2
  `Day 6 — Who Can Sound Like
• a grandma taking a bite of the cookies she just baked and realizing she forgot the sugar
• Santa laughing but he’s trying to laugh quietly so he doesn’t wake up the sleeping kids
• a squirrel who accidentally fell asleep in a Christmas tree at the tree farm and is waking up in some random person’s house`,

  `Day 7 — Make This Face
• The snowman you just finished building just said, “Sorry to bother you, but do you think you could make my nose a little less crooked”
• You’re smelling a very strong pine tree smell and you just realized it’s coming from your own armpit
• You just knocked an ornament off the tree and caught it JUST before it hit the ground`,

  `Day 8 — You Are
• A snowflake falling down from the sky and landing on top of a giant snowman and being so excited to be part of it
• A cold candy cane that accidentally got left out in the snow and then a little kid finally comes and picks you up
• A jar of sprinkles getting sprinkled all over the Christmas cookies`,

  `Day 9 — Would You Rather
• …be able to build a snowman that lasts year round even when it’s hot outside OR make paper snowflakes that turn into real snowflakes
• …be able to snap your fingers and make it snow outside OR snap your fingers and automatically decorate the whole neighborhood
• …your laugh sound like a deep, jolly Santa laugh OR like a little silly high-pitched elf`,

  `Day 10 — Plot Twist Story: The Case of the Missing Christmas Pajamas
• Just then, a little squeaky, mischievous laugh could be heard from under a nearby bush. Who was it
• “Help Help I don’t know how to stop this thing” shouted a voice from across the road. They turned to see a man on a snowboard being pulled by a donkey who was galloping as fast as he could
• Suddenly, the smell of cinnamon and apple cider wafted through the air, and that could only mean one thing`,

  // WEEK 3
  `Day 11 — Who Can Sound Like
• Two turtle doves cooing back and forth telling each other a funny story
• A gingerbread cookie that comes to life and is so excited it’s real
• Mrs. Claus humming a carol but then she accidentally sits down on a pinecone`,

  `Day 12 — Make This Face
• You just realized you ripped your pants right down the bottom when you were making a snow angel
• It’s snowing outside and you stick out your tongue to try to catch the snowflakes but then you realize it’s actually snowing mini marshmallows
• You just realized it’s so cold outside you have little snotsicles hanging out of your nose`,

  `Day 13 — You Are
• An ice skater doing the most amazing ice skating trick of all time
• A snowball rolling down a hill, getting bigger and bigger until you crash in a big fluffy Christmas tree
• A gingerbread cookie that is sad nobody picked it off the plate and then it finally gets picked`,

  `Day 14 — Would You Rather
• …have everything you eat for a day be gingerbread spice flavored OR turn into a magical gingerbread cookie for a whole day
• …have to change your name to Frosty OR have the song “Frosty the Snowman” play whenever you walk into the room
• …have to permanently dye your hair to be candy cane striped OR only wear candy cane striped clothes year-round`,

  `Day 15 — Plot Twist Story: The Day That Rudolph’s Nose Couldn’t Stop Changing Colors
• “Oh dear, this is a catastrophe” cried a voice from across the room. “I’ve lost my lucky candy cane I’ve been saving for 50 years” Who was it
• A gust of cold wind blew in along with a note that had a riddle on it that read: “Noses are red, gumdrops are blue, what is the thing that makes you truly YOU”
• Suddenly, an elf named Larry came running up, out of breath, saying, “I’ve done it My invention finally works Quick Come see, come see”`,

  // WEEK 4 START
  `Day 16 — Who Can Sound Like
• A professional chicken caroler bawking “Jingle Bells” for a crowd
• A little kid tasting a candy cane for the first time
• A french hen looking everywhere for its other two best french-hen-friends because they’re playing hide and seek`,

  `Day 17 — Make This Face
• You just smelled the most delicious gingerbread cookies baking in the oven and they’re going to be done in five minutes
• You just burped and it sounded JUST like “Silent Night” and everyone is very impressed, especially yourself
• You’re almost asleep on Christmas Eve but you THINK you just heard sleigh bells jingling outside`,

  `Day 18 — You Are
• A lucky, but stinky, pair of Christmas socks getting washed in the washing machine
• The one lightbulb on the Christmas tree that keeps going out because you’re honestly just so tired
• Jack Frost running around nipping at everyone’s nose (no actually nose-nipping, please)`,

  `Day 19 — Would You Rather
• …live in a gingerbread house OR live next door to Santa’s workshop
• …instantly grow a Santa Claus-looking beard every time someone says your name (and then it disappears after 30 seconds) OR have your nose light up like Rudolph’s for two minutes every time someone says your name
• …have a partridge that lives in a little pear tree and squawks to wake you up every morning OR have three french hens that live in your bathroom and are always getting in your way`,

  `Day 20 — Who Can Sound Like
• A jolly mommy snow owl hooting for her babies to come home for dinner
• A donkey singing its favorite Christmas carol (but can only sing the words “hee-haw”)
• Six geese a-laying eggs and honking to each other about how proud they are`,

  `Day 21 — Make This Face
• You just looked in the mirror and realized you’ve grown pointy elf ears and you’re not sure if you’re dreaming or not
• You just opened up a gift from your Great Aunt Mildred and it’s a Christmas sweater that has her own face embroidered on it and it lights up and plays polka music when you press the button
• Your nose just started lighting up red like Rudolph`,

  `Day 22 — Would You Rather
• …shrink down to the size of an ornament OR grow to the size of a Christmas tree for a day
• …have tiny snowflakes flutter down all around you every time you feel sleepy OR have sprinkles sprinkle down around you whenever you get excited
• …be the official cookie taste-tester of the North Pole OR be the official toy-tester at Santa’s workshop`,

  // FINALE
  `Day 23 — Truth or Merry Mischief
TRUTH: If you could only ever listen to one Christmas song, what would you choose
MERRY MISCHIEF: Step outside and sing “It’s the most wonderful time of the year” at the top of your lungs

TRUTH: What’s the best Christmas gift you ever got OR the best gift you ever gave someone
MERRY MISCHIEF: Build a snowman out of pillows and give it a name

TRUTH: If you were an elf, what do you think your name would be, and what kind of job would you have in Santa’s workshop
MERRY MISCHIEF: Act like a partridge in a pear tree. Flap and squawk

TRUTH: Are you a candy cane, a gingerbread cookie, or peppermint bark. Explain
MERRY MISCHIEF: Run around the room and say in a gingerbread voice, “Run, fun as fast as you can You can’t catch me, I’m the gingerbread man”

TRUTH: If you could only eat one holiday food for the rest of your life, what would it be
MERRY MISCHIEF: Make up an original holiday joke`,

  `Day 24 — Merry Mad Libs (Fill-in-the-Blanks Story)
Fill in the blanks by number:
1) Exclamation  2) Something you can feel  3) Body part  4) Verb ending in “ing”
5) Color  6) Color  7) Number  8) Animal  9) Something you can hold
10) Food  11) Feeling  12) Someone famous  13) Part of a house
14) Body part (plural)  15) Body part (plural)  16) Verb ending in “ing”
17) Verb  18) Food  19) Adjective  20) Verb

“(1)_______” Do you feel that little (2)______ in the air It sure is starting to feel like Christmas I can feel it in my (3)_________ — that jolly, warm excitement for the holiday season

Why, just yesterday, I was (4)_______ around downtown and was dazzled by all the (5)_______ and (6)_______ decorations. I even saw a (7)______-foot-tall inflatable (8)___________ wearing a Santa outfit, holding a (9)__________ Instant holiday spirit

Then I stopped to grab a nice hot cup of (10)_______-nog and felt (11)________ when I heard a remix of “Jolly Old (12)_________” and “Up on the (13)___________” Before I knew it, my (14)_________ were dancing by themselves and I was singing at the top of my (15)_________ Nobody minded — they were (16)_________ along, too

My favorite part of the season is time with family. I love (17)_______ together while eating spiced (18)_________ and laughing about all the (19)_________ memories of Christmases past

I hope you have a wonderful holiday. And don’t forget to (20)_________ as much as you can in the new year`
];


  /* ----------------- Elements ----------------- */
  const grid = document.getElementById('grid');
  const viewer = document.getElementById('viewer');
  const cardTitle = document.getElementById('cardTitle');
  const cardBody  = document.getElementById('cardBody');
  const closeBtn  = document.getElementById('closeBtn');

  /* ----------------- Tiles ----------------- */
  function makeTile(i){
    const day = i + 1;
    const el = document.createElement('button');
    el.className = 'tile';
    el.type = 'button';
    el.textContent = day;
    el.addEventListener('click', () => openViewer(day, IDEAS[i]));
    return el;
  }
  function renderGrid(){
    grid.innerHTML = '';
    for (let i=0; i<25; i++) grid.appendChild(makeTile(i));
  }
  renderGrid();

  /* ----------------- Viewer ----------------- */
  function openViewer(day, html){
    cardTitle.textContent = `Day ${day}`;
    cardBody.innerHTML = html;
    viewer.classList.add('open');
  }
  function closeViewer(){
    viewer.classList.remove('open');
  }
  viewer.addEventListener('click', (e) => { if (e.target === viewer) closeViewer(); });
  closeBtn.addEventListener('click', closeViewer);
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeViewer(); });

  /* ----------------- Courtesy / Privacy Gate ----------------- */
  const COURTESY_KEY = 'latw_courtesy_v1';
  const courtesyOverlay = document.getElementById('courtesyOverlay');
  const courtesyAck = document.getElementById('courtesyAck');
  const courtesyContinue = document.getElementById('courtesyContinue');
  const appWrap = document.getElementById('appWrap');

  function showGate(){
    appWrap.classList.add('blur');
    courtesyOverlay.style.display = 'grid';
  }
  function hideGate(){
    appWrap.classList.remove('blur');
    courtesyOverlay.style.display = 'none';
  }

  if (localStorage.getItem(COURTESY_KEY) !== 'yes') {
    showGate();
  }

  courtesyAck.addEventListener('change', () => {
    courtesyContinue.disabled = !courtesyAck.checked;
    courtesyContinue.style.cursor = courtesyAck.checked ? 'pointer' : 'not-allowed';
  });
  courtesyContinue.addEventListener('click', () => {
    if (!courtesyAck.checked) return;
    localStorage.setItem(COURTESY_KEY, 'yes');
    hideGate();
    // Reveal install-help bar after acceptance
    document.getElementById('install-help')?.classList.remove('gate-hide');
  });

  // If already accepted, show install-help immediately
  if (localStorage.getItem(COURTESY_KEY) === 'yes') {
    document.getElementById('install-help')?.classList.remove('gate-hide');
  }

  /* ----------------- Install Help (like WYR) ----------------- */
  (function(){
    const root = document.getElementById('install-help');
    const panel = document.getElementById('install-help-panel');
    if (!root || !panel) return;

    const closeBtn = root.querySelector('.install-help__close');
    const providedKey = root.getAttribute('data-dismiss-key');
    const key = providedKey && providedKey.trim().length ? providedKey : 'latw-install-help::' + location.pathname;

    try {
      if (new URLSearchParams(location.search).get('reset_install_tip') === '1') {
        localStorage.removeItem(key);
      }
    } catch(e) {}

    if(localStorage.getItem(key)==='1'){ root.classList.add('hidden'); return; }

    closeBtn.addEventListener('click', function(e){
      e.preventDefault(); e.stopPropagation();
      localStorage.setItem(key,'1');
      root.classList.add('hidden');
    });

    const neverBtn = document.getElementById('install-help-never');
    if(neverBtn){
      neverBtn.addEventListener('click', function(){
        localStorage.setItem(key,'1');
        root.classList.add('hidden');
      });
    }

    const ua = navigator.userAgent || '';
    const isIOS = /iPad|iPhone|iPod/.test(ua) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
    const isAndroid = /Android/i.test(ua);
    const isSamsung = /SamsungBrowser/i.test(ua);
    const isCriOS = /CriOS/i.test(ua);
    const isFxiOS = /FxiOS/i.test(ua);
    const isSafari = isIOS && /Safari/i.test(ua) && !isCriOS && !isFxiOS;
    const isChromeAndroid = isAndroid && /Chrome/i.test(ua) && !isSamsung;

    function show(id){ const el = document.getElementById(id); if(el) el.hidden = false; }

    if(isIOS && isSafari){ show('ios-safari'); }
    else if(isIOS && isCriOS){ show('ios-chrome'); }
    else if(isAndroid && isSamsung){ show('android-samsung'); }
    else if(isChromeAndroid){ show('android-chrome'); }
    else { show('other-browsers'); }

    const label = root.querySelector('.install-help__summary strong');
    const summaryBtn = root.querySelector('.install-help__summary');
    const closedText = 'Tap for a reminder on saving this app to your home screen';
    const openText = 'Hide instructions';
    root.addEventListener('toggle', function(){
      const exp = root.open ? 'true' : 'false';
      summaryBtn && summaryBtn.setAttribute('aria-expanded', exp);
      if(label){ label.textContent = root.open ? openText : closedText; }
    });
  })();

  /* ----------------- Snowfall ----------------- */
  const canvas = document.getElementById('snow');
  const ctx = canvas.getContext('2d');
  function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
  addEventListener('resize', resize); resize();
  const flakes = Array.from({length: Math.min(200, Math.floor(innerWidth/5))},
    () => ({ x: Math.random()*innerWidth, y: Math.random()*innerHeight, r: Math.random()*2+0.7, s: Math.random()*0.7+0.2 })
  );
  (function snow(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = 'rgba(255,255,255,0.95)';
    for (const f of flakes){
      ctx.beginPath(); ctx.arc(f.x, f.y, f.r, 0, Math.PI*2); ctx.fill();
      f.y += f.s; f.x += Math.sin(f.y*0.01);
      if (f.y > canvas.height) { f.y = -6; f.x = Math.random()*canvas.width; }
    }
    requestAnimationFrame(snow);
  })();

  /* ----------------- Install button (A2HS) ----------------- */
  const isStandalone =
    window.matchMedia('(display-mode: standalone)').matches ||
    window.navigator.standalone === true;
  const installBtn = document.getElementById('installBtn');
  let deferredPrompt;

  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    if (!isStandalone && installBtn) installBtn.style.display = 'inline-block';
  });

  if (installBtn) {
    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      installBtn.style.display = 'none';
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null;
    });
  }
  </script>

  <!-- Service worker registration (separate script block) -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          const reg = await navigator.serviceWorker.register('./sw.js?v=2025-11-06-1');
          if (reg.waiting) reg.waiting.postMessage({ type: 'SKIP_WAITING' });
          navigator.serviceWorker.addEventListener('controllerchange', () => {
            if (!window.__swReloaded) {
              window.__swReloaded = true;
              location.reload();
            }
          });
        } catch {}
      });
    }
  </script>

</body>
</html>
